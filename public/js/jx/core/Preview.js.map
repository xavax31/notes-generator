{"version":3,"sources":["../../../src/jx/core/Preview.js"],"names":["jx","MainCtrl","dataObject","onInitialised","resource","id","getURLParameter","type","src","decodeURIComponent","preload","console","log","start","end","alert","db","addResources","load","view","cc","image","x","y","resourceID","addChild","imagesequenceCreateJS","comp","initialise","data","JSON","parse","projectURL","projectJSON","configJSON","findOne","entryPoint","infos","projectInformations","configResources","resources","ratio","i","length","ratioArray","value","split","Number","config","app","item","dataItem","screen1","rid","ratioWidth","width","onStarted","undefined","_showAssetById","_showAssetFromData","sound","play","click","add","event","target","sParam","sPageURL","window","location","search","substring","sURLVariables","sParameterName","onResize"],"mappings":"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","file":"Preview.js","sourcesContent":["import ModuleType from \"jx/core/presets/Module\";\nlet jx;\nclass MainCtrl extends ModuleType {\n    constructor(dataObject) {\n        super(dataObject);\n        jx = this.jx;\n    }\n    /*******************************************************************************\n    * INIT\n    */\n    init({ onInitialised }) {\n        // this.view = this.cc({type: \"StageView\"});\n        onInitialised();\n    }\n    _showAssetById() {\n        var resource = {\n            id: this.getURLParameter(\"id\"),\n            type: this.getURLParameter(\"type\"),\n            src: decodeURIComponent(this.getURLParameter(\"src\")),\n            preload: true\n        };\n        console.log(resource.type);\n        switch (resource.type) {\n            case \"ImageSequence\":\n                resource.start = this.getURLParameter(\"start\");\n                resource.end = this.getURLParameter(\"end\");\n                break;\n            case \"Video\":\n            case \"Flashtml\":\n                break;\n            default:\n                alert(\"media not supported : \" + resource.type);\n                break;\n        }\n        console.log(resource);\n        this.jx.db.addResources(resource);\n        console.log(this.jx.db.log());\n        this.jx.db.load({ preload: true }, () => {\n            switch (resource.type) {\n                case \"ImageSequence\":\n                    this.view = this.cc({ type: \"StageView\" });\n                    var image = this.cc({ type: \"Image\", x: 0, y: 0, resourceID: \"Background\" });\n                    this.view.addChild(image);\n                    var imagesequenceCreateJS = this.cc({ type: \"ImageSequence\", x: 0, y: 0, resourceID: resource.id });\n                    this.view.addChild(imagesequenceCreateJS);\n                    break;\n                case \"Flashtml\":\n                    var comp = this.cc({ resourceID: resource.id });\n                    comp.initialise(evt => {\n                        this.view.addChild(comp);\n                    });\n                    break;\n                default:\n                    alert(\"media not supported\");\n                    break;\n            }\n        });\n    }\n    _showAssetFromData() {\n        var data = JSON.parse(decodeURIComponent(this.getURLParameter(\"data\")));\n        console.log(data);\n        var projectURL = data.projectURL + \"/public\";\n        var projectJSON = projectURL + \"/assets/config.json\";\n        console.log(projectJSON);\n        this.jx.db.addResources({ id: \"config2\", type: \"json\", src: projectJSON });\n        this.jx.db.load({ id: \"config2\" }, () => {\n            var configJSON = this.jx.db.findOne({ id: \"config2\" }).data;\n            var entryPoint = configJSON[\"entry-point\"];\n            var infos = configJSON.projectInformations;\n            var configResources = entryPoint.src.resources;\n            var ratio;\n            for (var i = 0; i < configResources.length; i++) {\n                if (configResources[i].id == \"ScreenRatio\") {\n                    var ratioArray = configResources[i].value.split(\"/\");\n                    ratio = Number(ratioArray[0]) / Number(ratioArray[1]);\n                }\n            }\n            ;\n            // console.log(configResources)\n            this.jx.db.addResources(configResources, projectURL);\n            this.jx.db.load({ preload: true }, () => {\n                this.view = this.cc({ type: \"StageView\", ratio: ratio || this.jx.config.app.ratio });\n                //console.log(this.jx.db.log());\n                console.log(data.item, this.jx.db.findOne({ id: data.item.id, type: data.item.type }));\n                var dataItem = this.jx.db.findOne({ id: data.item.id, type: data.item.type }).data;\n                console.log(dataItem);\n                var screen1 = this.cc({ rid: data.item.id });\n                screen1.initialise(evt => {\n                    screen1.ratioWidth = this.view.width;\n                    ;\n                    this.view.addChild(screen1);\n                });\n            });\n        });\n    }\n    /*******************************************************************************\n    * START\n    */\n    start({ onStarted }) {\n        onStarted();\n        if (this.getURLParameter(\"id\") != undefined) {\n            this._showAssetById();\n        }\n        else if (this.getURLParameter(\"data\") != undefined) {\n            this._showAssetFromData();\n        }\n        return;\n        var sound = this.jx.db.findOne({ id: \"MUSIC\" }).data;\n        sound.play();\n        //jx.dj.music.play(\"MUSIC\");\n        var image = this.cc({ type: \"Image\", id: \"SPLASHSCREEN\", resourceID: \"SPLASHSCREEN\" });\n        image.click.add((event) => { console.log(\"Click\", event.target.id, event.target); });\n        this.view.addChild(image);\n        var imagesequenceCreateJS = this.cc({ type: \"ImageSequence\", x: 0, y: 0, resourceID: \"TigerSequence\" });\n        this.view.addChild(imagesequenceCreateJS);\n    }\n    getURLParameter(sParam) {\n        var sPageURL = window.location.search.substring(1);\n        var sURLVariables = sPageURL.split('&');\n        for (var i = 0; i < sURLVariables.length; i++) {\n            var sParameterName = sURLVariables[i].split('=');\n            if (sParameterName[0] == sParam) {\n                return sParameterName[1];\n            }\n        }\n    }\n    onResize(event) {\n        this.view.onResize();\n    }\n}\nexport default MainCtrl;\n"]}