{"version":3,"sources":["../../../../src/jx/core/loaders/ImageSequenceLoader.js"],"names":["ImageSequenceLoader","resource","onFinished","jx","success","imageArray","loadResourcesArray","Array","j","start","end","src","replace","tools","intToString","request","id","push","batchLoader","db","classFromID","_onResourceLoaded","evt","load","failedResources","length","resourceArray","loadResources","loadedResources","i","resourceInfo","data","ready","target","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAEqBA,mB;AACjB,qCAAYC,QAAZ,EAAsBC,UAAtB,EAAkCC,EAAlC,EAAsC;AAAA;;AAClC,iBAAKA,EAAL,GAAUA,EAAV;AACA,iBAAKF,QAAL,GAAgBA,QAAhB;AACA,iBAAKC,UAAL,GAAkBA,UAAlB;AACA,iBAAKE,OAAL,GAAe,KAAf;AACA,iBAAKC,UAAL,GAAkB,IAAlB;AACH;;;;mCACM;AACH,oBAAI,CAAC,KAAKF,EAAV,EACI;;AAEJ,qBAAKA,EAAL,GAAU,IAAV;AACH;;;mCACM;AAAA;;AACH,oBAAIG,qBAAqB,IAAIC,KAAJ,EAAzB;AACA,qBAAK,IAAIC,IAAI,KAAKP,QAAL,CAAcQ,KAA3B,EAAkCD,KAAK,KAAKP,QAAL,CAAcS,GAArD,EAA0DF,GAA1D,EAA+D;AAC3D,wBAAIG,MAAM,KAAKV,QAAL,CAAcU,GAAd,CAAkBC,OAAlB,CAA0B,KAA1B,EAAiC,KAAKT,EAAL,CAAQU,KAAR,CAAcC,WAAd,CAA0BN,CAA1B,EAA6B,CAA7B,CAAjC,EAAkEI,OAAlE,CAA0E,IAA1E,EAAgF,KAAKT,EAAL,CAAQU,KAAR,CAAcC,WAAd,CAA0BN,CAA1B,EAA6B,CAA7B,CAAhF,EAAiHI,OAAjH,CAAyH,GAAzH,EAA8HJ,CAA9H,CAAV;AACA,wBAAIO,UAAU,sBAAY,EAAE,MAAM,KAAKd,QAAL,CAAce,EAAd,GAAmBR,CAA3B,EAA8B,OAAOG,GAArC,EAA0C,QAAQ,OAAlD,EAAZ,CAAd;AACAL,uCAAmBW,IAAnB,CAAwBF,OAAxB;AACH;AACD,oBAAIG,cAAc,KAAK,KAAKf,EAAL,CAAQgB,EAAR,CAAWC,WAAX,CAAuB,aAAvB,CAAL,EAA4Cd,kBAA5C,EAAgE;AAAA,2BAAO,MAAKe,iBAAL,CAAuBC,GAAvB,CAAP;AAAA,iBAAhE,EAAoG,KAAKnB,EAAzG,CAAlB;AACAe,4BAAYK,IAAZ;AACH;;;8CACiBL,W,EAAa;AAC3B,oBAAIA,YAAYM,eAAZ,CAA4BC,MAA5B,IAAsC,CAA1C,EAA6C;AACzC,wBAAIC,gBAAgB,IAAInB,KAAJ,EAApB;AACA,wBAAIoB,gBAAgBT,YAAYU,eAAhC;AACA,yBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAAcF,MAAlC,EAA0CI,GAA1C,EAA+C;AAC3C,4BAAIC,eAAeH,cAAcE,CAAd,CAAnB;AACA,4BAAI5B,WAAW,uBAAa6B,YAAb,CAAf;AACAJ,sCAAcT,IAAd,CAAmBhB,QAAnB;AACH;AACD,yBAAKA,QAAL,CAAc8B,IAAd,GAAqBL,aAArB;AACA,yBAAKzB,QAAL,CAAc+B,KAAd,GAAsB,IAAtB;AACA,yBAAK9B,UAAL,CAAgB,EAAE+B,QAAQ,IAAV,EAAgBhC,UAAU,KAAKA,QAA/B,EAAyCG,SAAS,IAAlD,EAAhB;AACH,iBAXD,MAYK;AACD8B,4BAAQC,GAAR,CAAY,KAAZ,EAAmB,KAAKlC,QAAL,CAAce,EAAjC,EAAqC,IAArC,EAA2C,KAAKf,QAAL,CAAcU,GAAzD;AACA,yBAAKT,UAAL,CAAgB,EAAE+B,QAAQ,IAAV,EAAgBhC,UAAU,KAAKA,QAA/B,EAAyCG,SAAS,KAAlD,EAAhB;AACH;AACJ;;;;;;sBAzCgBJ,mB","file":"ImageSequenceLoader.js","sourcesContent":["import Request from \"jx/core/Request\";\nimport Resource from \"jx/core/Resource\";\nexport default class ImageSequenceLoader {\n    constructor(resource, onFinished, jx) {\n        this.jx = jx;\n        this.resource = resource;\n        this.onFinished = onFinished;\n        this.success = false;\n        this.imageArray = null;\n    }\n    kill() {\n        if (!this.jx)\n            return;\n        // todo\n        this.jx = null;\n    }\n    load() {\n        var loadResourcesArray = new Array();\n        for (var j = this.resource.start; j <= this.resource.end; j++) {\n            var src = this.resource.src.replace(\"###\", this.jx.tools.intToString(j, 3)).replace(\"##\", this.jx.tools.intToString(j, 2)).replace(\"#\", j);\n            var request = new Request({ \"id\": this.resource.id + j, \"src\": src, \"type\": \"image\" });\n            loadResourcesArray.push(request);\n        }\n        var batchLoader = new (this.jx.db.classFromID(\"BatchLoader\"))(loadResourcesArray, evt => this._onResourceLoaded(evt), this.jx);\n        batchLoader.load();\n    }\n    _onResourceLoaded(batchLoader) {\n        if (batchLoader.failedResources.length == 0) {\n            var resourceArray = new Array();\n            var loadResources = batchLoader.loadedResources;\n            for (var i = 0; i < loadResources.length; i++) {\n                var resourceInfo = loadResources[i];\n                var resource = new Resource(resourceInfo);\n                resourceArray.push(resource);\n            }\n            this.resource.data = resourceArray;\n            this.resource.ready = true;\n            this.onFinished({ target: this, resource: this.resource, success: true });\n        }\n        else {\n            console.log('err', this.resource.id, this, this.resource.src);\n            this.onFinished({ target: this, resource: this.resource, success: false });\n        }\n    }\n}\n"]}