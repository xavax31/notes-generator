{"version":3,"sources":["../../../../src/jx/core/loaders/ImageLoader.js"],"names":["ImageLoader","resource","onFinished","jx","_loader","success","createjs","LoadQueue","config","system","audio","isWebAudioSupported","on","_resourceLoaded","_resourceFailed","loadFile","id","src","removeAllEventListeners","removeAll","destroy","event","removeEventListener","result","setTimeout","_offsetResourceLoaded","data","ready","target"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAAqBA,W;AACjB,6BAAYC,QAAZ,EAAsBC,UAAtB,EAAkCC,EAAlC,EAAsC;AAAA;;AAElC,iBAAKA,EAAL,GAAUA,EAAV;AACA,iBAAKC,OAAL,GAAe,IAAf;AACA,iBAAKH,QAAL,GAAgBA,QAAhB;AACA,iBAAKC,UAAL,GAAkBA,UAAlB;AACA,iBAAKG,OAAL,GAAe,KAAf;AACH;;;;mCACM;AAGH,qBAAKD,OAAL,GAAe,IAAIE,SAASC,SAAb,CAAuB,KAAKJ,EAAL,CAAQK,MAAR,CAAeC,MAAf,CAAsBC,KAAtB,CAA4BC,mBAAnD,CAAf;AACA,qBAAKP,OAAL,CAAaQ,EAAb,CAAgB,UAAhB,EAA4B,KAAKC,eAAjC,EAAkD,IAAlD;AACA,qBAAKT,OAAL,CAAaQ,EAAb,CAAgB,OAAhB,EAAyB,KAAKE,eAA9B,EAA+C,IAA/C;AACA,qBAAKV,OAAL,CAAaW,QAAb,CAAsB,EAAEC,IAAI,KAAKf,QAAL,CAAce,EAApB,EAAwBC,KAAK,KAAKhB,QAAL,CAAcgB,GAA3C,EAAtB;AACH;;;mCACM;AACH,oBAAI,CAAC,KAAKd,EAAV,EACI;AACJ,qBAAKC,OAAL,CAAac,uBAAb;AACA,qBAAKd,OAAL,CAAae,SAAb;AACA,qBAAKf,OAAL,CAAagB,OAAb;AACA,qBAAKhB,OAAL,GAAe,IAAf;AACA,qBAAKF,UAAL,GAAkB,IAAlB;AACA,qBAAKD,QAAL,GAAgB,IAAhB;AACA,qBAAKE,EAAL,GAAU,IAAV;AACH;;;4CACekB,K,EAAO;AAAA;;AAEnB,qBAAKjB,OAAL,CAAakB,mBAAb,CAAiC,UAAjC,EAA6C,KAAKT,eAAlD;AACA,qBAAKT,OAAL,CAAakB,mBAAb,CAAiC,OAAjC,EAA0C,KAAKR,eAA/C;AACA,oBAAIS,SAASF,MAAME,MAAnB;AACA,qBAAKlB,OAAL,GAAe,IAAf;AACAmB,2BAAW,YAAM;AAAE,0BAAKC,qBAAL,CAA2BF,MAA3B;AAAqC,iBAAxD,EAA0D,EAA1D;AACH;;;kDACqBA,M,EAAQ;AAC1B,qBAAKtB,QAAL,CAAcyB,IAAd,GAAqBH,MAArB;AACA,qBAAKtB,QAAL,CAAc0B,KAAd,GAAsB,IAAtB;AACA,qBAAKzB,UAAL,CAAgB,EAAE0B,QAAQ,IAAV,EAAgB3B,UAAU,KAAKA,QAA/B,EAAyCI,SAAS,IAAlD,EAAhB;AACH;;;4CACegB,K,EAAO;AAEnB,qBAAKjB,OAAL,CAAakB,mBAAb,CAAiC,UAAjC,EAA6C,KAAKT,eAAlD;AACA,qBAAKT,OAAL,CAAakB,mBAAb,CAAiC,OAAjC,EAA0C,KAAKR,eAA/C;AACA,qBAAKT,OAAL,GAAe,KAAf;AACA,qBAAKH,UAAL,CAAgB,EAAE0B,QAAQ,IAAV,EAAgB3B,UAAU,KAAKA,QAA/B,EAAyCI,SAAS,KAAlD,EAAhB;AACH;;;;;;sBA/CgBL,W","file":"ImageLoader.js","sourcesContent":["export default class ImageLoader {\n    constructor(resource, onFinished, jx) {\n        //alert(resource.id)\n        this.jx = jx;\n        this._loader = null;\n        this.resource = resource;\n        this.onFinished = onFinished;\n        this.success = false;\n    }\n    load() {\n        //console.log(\"load \" + this.resource.id)\n        // (this.jx.config.systemInfo.os==\"ipad\") \n        this._loader = new createjs.LoadQueue(this.jx.config.system.audio.isWebAudioSupported);\n        this._loader.on(\"fileload\", this._resourceLoaded, this);\n        this._loader.on(\"error\", this._resourceFailed, this);\n        this._loader.loadFile({ id: this.resource.id, src: this.resource.src });\n    }\n    kill() {\n        if (!this.jx)\n            return;\n        this._loader.removeAllEventListeners();\n        this._loader.removeAll();\n        this._loader.destroy();\n        this._loader = null;\n        this.onFinished = null;\n        this.resource = null;\n        this.jx = null;\n    }\n    _resourceLoaded(event) {\n        //console.log(\"_resourceLoaded \" + this.resource.id)\n        this._loader.removeEventListener(\"fileload\", this._resourceLoaded);\n        this._loader.removeEventListener(\"error\", this._resourceFailed);\n        var result = event.result;\n        this.success = true;\n        setTimeout(() => { this._offsetResourceLoaded(result); }, 10);\n    }\n    _offsetResourceLoaded(result) {\n        this.resource.data = result;\n        this.resource.ready = true;\n        this.onFinished({ target: this, resource: this.resource, success: true });\n    }\n    _resourceFailed(event) {\n        //console.log( 'err', event.title, this.resource.id, this, this.resource.src );\n        this._loader.removeEventListener(\"fileload\", this._resourceLoaded);\n        this._loader.removeEventListener(\"error\", this._resourceFailed);\n        this.success = false;\n        this.onFinished({ target: this, resource: this.resource, success: false });\n    }\n}\n"]}