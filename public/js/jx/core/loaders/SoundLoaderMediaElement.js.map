{"version":3,"sources":["../../../../src/jx/core/loaders/SoundLoaderMediaElement.js"],"names":["SoundLoaderMediaElement","resource","onloaded","jx","_loader","success","loader","signals","Signal","addOnce","html1","id","src","div1","document","createElement","innerHTML","domSound","firstChild","body","appendChild","addEventListener","event","console","log","_resourceFailed","text","mediaSound","MediaElement","canplay","playing","_resLoaded","_resourceLoaded","load","removeEventListener","data","ready","dispatch","target"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAAqBA,uB;AACjB,yCAAYC,QAAZ,EAAsBC,QAAtB,EAAgCC,EAAhC,EAAoC;AAAA;;AAChC,iBAAKA,EAAL,GAAUA,EAAV;AACA,iBAAKC,OAAL,GAAe,IAAf;AACA,iBAAKH,QAAL,GAAgBA,QAAhB;AACA,iBAAKI,OAAL,GAAe,KAAf;AACA,iBAAKJ,QAAL,CAAcK,MAAd,GAAuB,IAAvB;AACA,iBAAKJ,QAAL,GAAgB,IAAIK,QAAQC,MAAZ,EAAhB;AACA,gBAAIN,QAAJ,EACI,KAAKA,QAAL,CAAcO,OAAd,CAAsBP,QAAtB;AACP;;;;mCACM;AACH,oBAAI,CAAC,KAAKC,EAAV,EACI;;AAEJ,qBAAKA,EAAL,GAAU,IAAV;AACH;;;mCACM;AAAA;;AACH,oBAAIO,QAAQ,gBAAgB,KAAKT,QAAL,CAAcU,EAA9B,GAAmC,iBAAnC,GAAuD,KAAKV,QAAL,CAAcW,GAArE,GAA2E,8BAAvF;AACA,oBAAIC,OAAOC,SAASC,aAAT,CAAuB,KAAvB,CAAX;AACAF,qBAAKG,SAAL,GAAiBN,KAAjB;AACA,oBAAIO,WAAWJ,KAAKK,UAApB;AACAJ,yBAASK,IAAT,CAAcC,WAAd,CAA0BH,QAA1B;AACAA,yBAASI,gBAAT,CAA0B,OAA1B,EAAmC,UAACC,KAAD,EAAW;AAC1CC,4BAAQC,GAAR,CAAYF,KAAZ;AACA,0BAAKG,eAAL,CAAqB,EAAEC,MAAM,WAAR,EAArB;AACH,iBAHD;AAIA,qBAAKC,UAAL,GAAkB,IAAIC,YAAJ,CAAiB,KAAK3B,QAAL,CAAcU,EAA/B,EAAmC,EAAnC,CAAlB;AAQA,qBAAKgB,UAAL,CAAgBE,OAAhB,GAA0B,KAA1B;AACA,qBAAKF,UAAL,CAAgBG,OAAhB,GAA0B,KAA1B;AACA,qBAAKC,UAAL,GAAkB;AAAA,2BAAM,MAAKC,eAAL,CAAqB,EAArB,CAAN;AAAA,iBAAlB;AACA,qBAAKL,UAAL,CAAgBN,gBAAhB,CAAiC,gBAAjC,EAAmD,KAAKU,UAAxD;AACA,qBAAKJ,UAAL,CAAgBM,IAAhB;AACH;;;4CACeX,K,EAAO;AACnBC,wBAAQC,GAAR,CAAY,UAAZ;AACA,qBAAKG,UAAL,CAAgBE,OAAhB,GAA0B,IAA1B;AACA,qBAAKF,UAAL,CAAgBO,mBAAhB,CAAoC,gBAApC,EAAsD,KAAKH,UAA3D;AACA,qBAAK9B,QAAL,CAAckC,IAAd,GAAqB,KAAKR,UAA1B;AACA,qBAAK1B,QAAL,CAAcmC,KAAd,GAAsB,IAAtB;AACA,qBAAKnC,QAAL,CAAcK,MAAd,GAAuB,IAAvB;AACA,qBAAKJ,QAAL,CAAcmC,QAAd,CAAuB,EAAEC,QAAQ,IAAV,EAAgBrC,UAAU,KAAKA,QAA/B,EAAyCI,SAAS,IAAlD,EAAvB;AACH;;;4CACeiB,K,EAAO;AACnBC,wBAAQC,GAAR,CAAY,KAAZ,EAAmBF,KAAnB,EAA0B,KAAKrB,QAAL,CAAcU,EAAxC,EAA4C,IAA5C,EAAkD,KAAKV,QAAL,CAAcW,GAAhE;AACA,qBAAKX,QAAL,CAAcK,MAAd,GAAuB,IAAvB;AACA,qBAAKJ,QAAL,CAAcmC,QAAd,CAAuB,EAAEC,QAAQ,IAAV,EAAgBrC,UAAU,KAAKA,QAA/B,EAAyCI,SAAS,KAAlD,EAAvB;AACH;;;;;;sBAtDgBL,uB","file":"SoundLoaderMediaElement.js","sourcesContent":["export default class SoundLoaderMediaElement {\n    constructor(resource, onloaded, jx) {\n        this.jx = jx;\n        this._loader = null;\n        this.resource = resource;\n        this.success = false;\n        this.resource.loader = this;\n        this.onloaded = new signals.Signal();\n        if (onloaded)\n            this.onloaded.addOnce(onloaded);\n    }\n    kill() {\n        if (!this.jx)\n            return;\n        // todo\n        this.jx = null;\n    }\n    load() {\n        var html1 = \"<audio id='\" + this.resource.id + \"'><source src='\" + this.resource.src + \"' type='audio/mp3'/></audio>\";\n        var div1 = document.createElement(\"div\");\n        div1.innerHTML = html1;\n        var domSound = div1.firstChild;\n        document.body.appendChild(domSound);\n        domSound.addEventListener(\"error\", (event) => {\n            console.log(event);\n            this._resourceFailed({ text: \"not found\" });\n        });\n        this.mediaSound = new MediaElement(this.resource.id, {\n        // enablePluginDebug: true,\n        // //success: (event)=>this._resourceLoaded(event)\n        // error: function(e) {\n        // \tconsole.log(\"heps\")\n        // }\n        //(event)=>this._resourceFailed(event)\n        });\n        this.mediaSound.canplay = false;\n        this.mediaSound.playing = false;\n        this._resLoaded = () => this._resourceLoaded({});\n        this.mediaSound.addEventListener(\"canplaythrough\", this._resLoaded);\n        this.mediaSound.load();\n    }\n    _resourceLoaded(event) {\n        console.log(\"loaderes\");\n        this.mediaSound.canplay = true;\n        this.mediaSound.removeEventListener(\"canplaythrough\", this._resLoaded);\n        this.resource.data = this.mediaSound; // createjs.Sound.createInstance(this.resource.id);\n        this.resource.ready = true;\n        this.resource.loader = null; //detach reference to this\n        this.onloaded.dispatch({ target: this, resource: this.resource, success: true });\n    }\n    _resourceFailed(event) {\n        console.log('err', event, this.resource.id, this, this.resource.src);\n        this.resource.loader = null;\n        this.onloaded.dispatch({ target: this, resource: this.resource, success: false });\n    }\n}\n"]}