{"version":3,"sources":["../../../../src/jx/core/loaders/SpriteSheetLoader.js"],"names":["SpriteSheetLoader","resource","onFinished","jx","success","_assets","_loader","createjs","LoadQueue","on","_resourceLoaded","_onComplete","_resourceFailed","loadManifest","id","src","crossOrigin","removeAllEventListeners","removeAll","destroy","evt","removeEventListener","result","frames","animations","images","setTimeout","_offsetResourceLoaded","event","push","data","ready","target","console","log","title"],"mappings":"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","file":"SpriteSheetLoader.js","sourcesContent":["export default class SpriteSheetLoader {\n    constructor(resource, onFinished, jx) {\n        this.jx = jx;\n        this.resource = resource;\n        this.onFinished = onFinished;\n        this.success = false;\n    }\n    load() {\n        //console.log(\"load\");\n        this._assets = [];\n        this._loader = new createjs.LoadQueue();\n        this._loader.on(\"fileload\", this._resourceLoaded, this);\n        this._loader.on(\"complete\", this._onComplete, this);\n        this._loader.on(\"error\", this._resourceFailed, this);\n        this._loader.loadManifest([\n            { id: this.resource.id + \"_JSON\", src: this.resource.src + \".json\", crossOrigin: true },\n            { id: this.resource.id, src: this.resource.src + \".png\", crossOrigin: true }\n        ]);\n    }\n    kill() {\n        if (!this.jx)\n            return;\n        this._loader.removeAllEventListeners();\n        this._loader.removeAll();\n        this._loader.destroy();\n        this._loader = null;\n        this.onFinished = null;\n        this.resource = null;\n        this.jx = null;\n    }\n    _onComplete(evt) {\n        //console.log(\"oncomplete\", this._assets)\n        this._loader.removeEventListener(\"complete\", this._onComplete);\n        this._loader.removeEventListener(\"fileload\", this._resourceLoaded);\n        this._loader.removeEventListener(\"error\", this._resourceFailed);\n        //console.log(\"event.data\", event.result );\n        var result = {\n            frames: this._assets[0].result.frames,\n            animations: this._assets[0].result.animations,\n            images: [this._assets[1].result]\n        };\n        this.success = true;\n        setTimeout(() => { this._offsetResourceLoaded(result); }, 10);\n    }\n    _resourceLoaded(event) {\n        this._assets.push(event);\n        //console.log(\"_resourceLoaded \" + this.resource.id)\n        //alert(\"_resourceLoaded \" + this.resource.id);\n        // this._loader.removeEventListener( \"fileload\", this._resourceLoaded);\n        // this._loader.removeEventListener( \"error\", this._resourceFailed);\n        // //console.log(\"event.data\", event.result );\n        // var result=event.result;\n        // this.success=true;\n        // setTimeout(()=>{ this._offsetResourceLoaded(result)}, 10);\n    }\n    _offsetResourceLoaded(result) {\n        this.resource.data = result;\n        this.resource.ready = true;\n        this.onFinished({ target: this, resource: this.resource, success: true });\n    }\n    _resourceFailed(event) {\n        //alert( 'err'+event.title+\"\\n\"+this.resource.id +\"\\n\"+ this.resource.src);\n        console.log('err', event.title, this.resource.id, this, this.resource.src);\n        this._loader.removeEventListener(\"fileload\", this._resourceLoaded);\n        this._loader.removeEventListener(\"error\", this._resourceFailed);\n        this.success = false;\n        this.onFinished({ target: this, resource: this.resource, success: false });\n    }\n}\n"]}