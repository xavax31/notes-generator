{"version":3,"sources":["../../../src/jx/core/Launcher.js"],"names":["Launcher","dataObject","window","push","launcher","Date","now","console","log","core","debug","mode","tools","mergeObjectIn","modes","presetParams","onInitialised","moduleInitialised","undefined","evt","addEventListener","event","data","type","method","response","context","alreadyLaunch","_launchModule","config","urlParams","rid","db","importClass","Preview","mainCtrl","initialise","preset","Preset","src","moduleLoad","addResources","id","load","moduleLoaded","mainCtrlClass","findOne","moduleInstancied"],"mappings":"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","file":"Launcher.js","sourcesContent":["import \"jx/polyfill.min\";\nimport JXCore from \"jx/core/JXCore\";\nexport default class Launcher {\n    constructor(dataObject) {\n        window[\"jxTiming\"].push({ launcher: Date.now() });\n        // {\n        // \tmodes: [],\n        // \tmode: \"prod\", \n        // \tdebug: false\n        // \tonInitialised : evt=>{} // jxApp\n        // }\n        ////console.log(\"Launcher\", dataObject);\n        console.log(`\n\t\t     ___  __  _____ _   _  ____ ___ _   _ _____ \n\t\t    | \\\\ \\\\/ / | ____| \\\\ | |/ ___|_ _| \\\\ | | ____|\n\t\t _  | |\\\\  /  |  _| |  \\\\| | |  _ | ||  \\\\| |  _|  \n\t\t| |_| |/  \\\\  | |___| |\\\\  | |_| || || |\\\\  | |___ \n\t\t \\\\___//_/\\\\_\\\\ |_____|_| \\\\_|\\\\____|___|_| \\\\_|_____|\n\t\t                                                   1.0\t\t                                                  \n\t\t`);\n        this.dataObject = dataObject; // Object.assign({src: null, preset: null, debug: false, plugs: []}, dataObject);\n        //window[\"jxTiming\"].push({launcher2newJXCore:Date.now()});\n        var core = new JXCore({ debug: this.dataObject.debug });\n        //window[\"jxTiming\"].push({launcher3newJXCoreOk:Date.now()});\n        window[\"jx\"] = core;\n        if (this.dataObject.mode) {\n            core.tools.mergeObjectIn(this.dataObject, this.dataObject.modes[this.dataObject.mode]);\n        }\n        let presetParams = this.dataObject;\n        this.onInitialised = presetParams.onInitialised;\n        presetParams.onInitialised = evt => {\n            window[\"jxTiming\"].push({ moduleInitialised: Date.now() });\n            if (this.onInitialised !== undefined) {\n                // core.debug.logTime(\"MainCtrl started\", \"jx\");\n                // core.debug.logTimeMarkers();\n                //this.mainCtrl.jx.debug.logTimeMarkers();\n                this.onInitialised(evt);\n            }\n        };\n        //presetParams.resourceClassesArray=packages;\n        //window[\"jxTiming\"].push({launcher3:Date.now()});\n        window.addEventListener(\"message\", event => {\n            return;\n            if (event.data.type == \"containerInfo\") {\n                // send by bayam app\n                // provide data : \n                // \t\tappHeight: 752\n                // \t\tappWidth: 1280\n                // \t\tcontentScale: 1\n                // \t\tisNarrowRatio: false\n                // \t\tisPhone: false\n            }\n            else if (event.data.type == \"evtReady\") {\n                // send by bayam app\n                // provide data : \n                // \t\tage: 5\n                // \t\tcontext: \"bayamapp\"\n                // \t\tplatform: \"Linux armv8l\"\n                // \t\tsupport: \"mobile\"\n                // \t\tuseragent: \"Mozilla/5.0 (Linux; Android 6.0; A3-A40 Build/MRA58K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Crosswalk/18.48.477.13 Safari/537.36\"\n                // \t\tvolume: 0.5\n            }\n            else if (event.data.method == \"requestAzoomeeVersion\" && event.data.response) {\n                // response to our parent.postMessage(method: \"requestAzoomeeVersion\") below.\n                // note that in bayam app, this message is not received, like as bayam intercepts and block our postMessage (to check)\n                window[\"overrideJXConfig\"].context = \"azoomee\";\n            }\n            if (this.alreadyLaunch)\n                return; // to be sure to launch mainCtrl only once time, even if we receive more messages.\n            this.alreadyLaunch = true;\n            this._launchModule(presetParams);\n        }, false);\n        // parent.postMessage({method: \"requestAzoomeeVersion\", responseID: \"idToIdentifyAnswer\"}, \"*\");\n        this._launchModule(presetParams);\n    }\n    _launchModule(presetParams) {\n        let core = window[\"jx\"];\n        if (core.config.urlParams.rid != undefined) {\n            core.db.importClass([\"jx/core/presets/Preview\"], (Preview) => {\n                //core.debug.logTime(\"Preview loaded\");\n                this.mainCtrl = new Preview(presetParams);\n                this.mainCtrl.initialise(presetParams.onInitialised);\n            });\n        }\n        else if (this.dataObject.preset != undefined) {\n            core.db.importClass([\"jx/core/presets/\" + this.dataObject.preset], (Preset) => {\n                //core.debug.logTime(\"Preset loaded\");\n                this.mainCtrl = new Preset(presetParams);\n                this.mainCtrl.initialise(presetParams.onInitialised);\n            });\n        }\n        else if (this.dataObject.src != undefined) {\n            window[\"jxTiming\"].push({ moduleLoad: Date.now() });\n            core.db.addResources({ id: \"Module1\", type: \"class\", src: this.dataObject.src });\n            core.db.load({ id: \"Module1\" }, evt => {\n                window[\"jxTiming\"].push({ moduleLoaded: Date.now() });\n                var mainCtrlClass = core.db.findOne({ id: \"Module1\" }).data;\n                //console.log(\"Launch App\", this.dataObject.src, presetParams);\n                this.mainCtrl = new mainCtrlClass(presetParams);\n                window[\"jxTiming\"].push({ moduleInstancied: Date.now() });\n                this.mainCtrl.initialise(presetParams.onInitialised);\n            });\n        }\n    }\n}\n"]}