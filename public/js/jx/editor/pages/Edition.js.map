{"version":3,"sources":["../../../../src/jx/editor/pages/Edition.js"],"names":["userAccess","editGabarit","openProjectDir","openTerminal","openSublimeProject","generateAPIDoc","extraActionsGroup","showAPIDoc","serverSyncDial","pullProject","pushProject","pushProjectSrc","preview","previewDebug","previewDev","transpilProject","save","showVersion","testBtnDev","compareJSON","updateInternJX","gabaritEditorBox","viewsModels","tab","flat","Edition","dataObject","Object","assign","id","url","mode","lang","activeTabParams","uniqTabID","_logsEnabled","editor","jx","_connectToSockets","projectURL","decodeURIComponent","getProjectManager","projectManager","project","load","_loadCustomComps","_loadFontsList","_createPage","loadingScreen","show","view","$","html","info","title","trim","ccid","type","controller","menuTop","setMenu","mainMenu","gabaritView","_gabaritViewCreate","append","readMode","hideInfo","foldTexts","wait","refreshEditionView","_setRemoteDeamon","hide","_setLogs","template","tabs","onchanged","add","console","log","evt","firstItem","saveOnChange","host","io","on","username","context","action","args","config","system","setAsLocked","name","_modeDisplay","setAsUnlocked","enabled","createDir","date","Date","dateStr","getFullYear","Number","getMonth","getDate","getHours","getMinutes","getSeconds","data","value","user","db","saveJSONCompressed","itemID","callback","toLoad","foreachInGabarit","gabarit","func","item","path","split","classDefined","join","push","src","replace","addAndLoad","resources","ResourcesFontsList","json","getOptionsList","fontsDefs","fontsList","fontsNameArr","i","length","fontFamily","fonts","idTab","children","deleteTab","removeInGabarit","activeTab","list","loadedPlugs","result","_deamon","cc","interval","refreshLocks","lock","start","functionnality","hasFunctionnality","group","arr","userIsGroup","btInfosToggle","showAllInfos","hideAllInfos","btUnfoldTextsToggle","textFold","emit","unlock","permanentLock","popup","content","reload","refreshView","event","target","attr","scroll","editView","find","scrollTop","showTab","modeDisplay","css","top","position","outerHeight","height","window","setGabaritEditor","screenID","itemData","asset","win","open","end","encodeURIComponent","document","write","close","warn","download","prefixZip","internPath","pop","deleteFile","urlArray","parentDirURL","openFile","childrenG","getInGabarit","results","getInGabaritByType","concat","splice","fontList","resultCSS","parsed","fontStyle","indexOf","fontCSS","refreshInfo","generateFontsListCSS","setProjectTitle","exportConfig","_gabaritEditorErrors","annot","gabaritEditor","getSession","getAnnotations","key","text","row","onclose","gotoLine","saveGabaritIntern","gabaritEditorLastPosition","column","resize","moveCursorTo","jsonObj","JSON","parse","stringify","loadGabaritIntern","err","alert","message","hideComponent","scrollTo","btGabaritJSONEditorToggle","showComponent","gabaritIsVisible","_hideGabaritEditor","_showGabaritEditor","search","backwards","wrap","caseSensitive","wholeWord","regExp","findNext","findPrevious","snippetsLib","snippets","getAll","unshift","optionCB","snippetsDOM","el","createElement","textContent","desc","getSnippet","addEventListener","selectedIndex","insert","ace","edit","setOptions","$blockScrolling","Infinity","setTheme","setShowFoldWidgets","setMode","jsonResource","getJSON","setValue","moveCursorToPosition","fileURL","configPath","saveText","getValue","getCursorPosition","loadText","popupContent","magnificPopup","items","click","prop","checked","generateReport","projectData"],"mappings":"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","file":"Edition.js","sourcesContent":["import Component from \"jx/core/comps/Component\";\nimport Snippets from \"jx/editor/editorcode/snippets/Snippets\";\nimport MenuEdition from \"jx/editor/pages/edition_comps/MenuEdition\";\nimport MenuEditionTop from \"jx/editor/pages/edition_comps/MenuEditionTop\";\nimport GabaritObject from \"jx/editor/editionitems/GabaritObject\";\nlet userAccess = {\n    editGabarit: \"dev\",\n    openProjectDir: \"dev\",\n    openTerminal: \"dev\",\n    openSublimeProject: \"dev\",\n    generateAPIDoc: \"dev\",\n    extraActionsGroup: \"dev\",\n    showAPIDoc: \"dev\",\n    serverSyncDial: \"dev\",\n    pullProject: \"dev\",\n    pushProject: \"dev\",\n    pushProjectSrc: \"dev\",\n    preview: \"*\",\n    previewDebug: \"dev\",\n    previewDev: \"dev\",\n    transpilProject: \"dev\",\n    save: \"dev\",\n    showVersion: \"dev\",\n    testBtnDev: \"dev\",\n    compareJSON: \"dev\",\n    updateInternJX: \"dev\"\n};\nlet gabaritEditorBox = `<div id=\"gabaritEditorBox\" style=\"display:none;top:150px\">\n<div class=\"row\" style=\"width:100%; background-color:#ADCCFF\">\n\t<div class=\"col-xs-12\" style=\"width:100%\">\n\t\t<input id=\"search\" type=\"search\"></input>\n\t\t<div class=\"btn-group\" role=\"group\" aria-label=\"...\">\n\t\t\t<button type=\"button\" id=\"searchPrevious\" class=\"btn btn-default\" title=\"Next\"><span class=\"fa fa-arrow-left\"></span></button>\n\t\t\t<button type=\"button\" id=\"searchNext\" class=\"btn btn-default\"  title=\"Previous\"><span class=\"fa fa-arrow-right\"></span></button>\n\t\t</div>              \n\n\t\t<div id=\"snippetsBtns\" class=\"btn-group\" role=\"group\" aria-label=\"...\">\n\t\t</div>\n\n\t</div>           \n</div>    \n<div class=\"row\" style=\"height:93%;width:100%\">\n\t<div class=\"col-xs-12\" style=\"height:100%;width:100%\">\n\t\t<div id=\"gabaritEditor\" style=\"height:100%;width:100%\"></div>\n\t</div>           \n</div>    \n</div>\n`;\nlet viewsModels = {\n    tab: `\n<div class=\"container-fluid\">\n    <div class=\"row\" >\n        <!-- MENU -->\n        <div class=\"col-xs-3\" id=\"myScrollspy\" style=\"top:120px;position:fixed\">\n            <ul id=\"mapList\" class=\"nav nav-pills nav-stacked nav-tabs\"></ul>\n        </div>\n        <!-- MENU END -->\n\n        <div class=\"col-xs-9 pull-right\" id=\"mapcontent\" style=\"top:80px\">\n            <div id=\"map\" class=\"tab-content content1\"></div>\n        </div>\n    </div>\n\t${gabaritEditorBox}\n\n </div>\n`,\n    flat: `\n<div class=\"container\">\n    <div class=\"row\">\n        <!-- MENU -->\n        <div class=\"col-xs-1\" id=\"myScrollspy\">\n            <ul id=\"mapList\" class=\"nav nav-pills nav-stacked  nav-tabs\"></ul>\n        </div>\n        <!-- MENU END -->\n\n        <div class=\"col-xs-11\" style=\"top:120px\">\n            <div id=\"map\"></div>\n        </div>\n    </div>\n\n\t${gabaritEditorBox}           \n</div>\n`\n};\n/**\n * Manage edition page of a project.\n * @ignore\n */\nexport default class Edition extends Component {\n    constructor(dataObject) {\n        super(Object.assign({\n            id: null,\n            url: null,\n            mode: \"edititems\"\n        }, dataObject));\n        this.lang = \"fr\";\n        this.activeTabParams = {};\n        this.uniqTabID = 0;\n        this._logsEnabled = false;\n        this.editor = this.jx.editor;\n        this._connectToSockets();\n        let projectURL = decodeURIComponent(this.dataObject.url);\n        this.editor.getProjectManager({ url: projectURL }, (projectManager) => {\n            this.project = projectManager;\n            this.project.load(evt => {\n                this._loadCustomComps(() => {\n                    this._loadFontsList(() => {\n                        this._createPage();\n                    });\n                });\n            });\n        });\n    }\n    get mainController() {\n        return this;\n    }\n    /** Create interface */\n    _createPage() {\n        this.jx.loadingScreen.show();\n        this.view = $(\"body\");\n        $('title').html((this.project.info.title && this.project.info.title.trim() != \"\")\n            ? this.project.info.title\n            : this.project.info.id);\n        this.ccid({ id: \"menuTop\", type: MenuEditionTop });\n        this.ccid({ id: \"mainMenu\", type: MenuEdition,\n            project: this.project,\n            controller: this\n        });\n        this.menuTop.setMenu(this.mainMenu);\n        this.gabaritView = this._gabaritViewCreate();\n        this.view.append(this.gabaritView.view);\n        this.readMode();\n        this.hideInfo();\n        this.foldTexts();\n        this.jx.wait(1000, () => {\n            this.refreshEditionView();\n            this.readMode();\n            this.hideInfo();\n            this.foldTexts();\n            this._setRemoteDeamon();\n            this.jx.loadingScreen.hide();\n        });\n        this._setLogs(this._logsEnabled);\n    }\n    _gabaritViewCreate() {\n        let gabaritView = this.ccid({ id: \"gabaritView\", type: GabaritObject,\n            controller: this,\n            template: viewsModels,\n            mode: this.dataObject.mode,\n            // gabarit: this.project.info.gabarit,\n            tabs: true\n        });\n        gabaritView.onchanged.add(evt => {\n            console.log(!evt.firstItem.saveOnChange, evt);\n            if (evt.firstItem.saveOnChange === false)\n                return;\n            this.save();\n        });\n        return gabaritView;\n    }\n    _connectToSockets() {\n        this.editor.host.io.on('userAction', ({ username, context, action, args }) => {\n            // console.log('User ' + username + \"(\", context, \") make action \" + action, args);\n            //-- If server Editor only AND user context is server too, we refresh edit/read mode of the view.\n            // if (1==1) {\n            if (this.jx.config.system.host.type != \"local\" && context != \"local\") {\n                if (action == \"lockProject\") {\n                    console.log('User ' + username + \" lock project \");\n                    if (this.project.info.url == args.url) { // if same project\n                        this.project.setAsLocked({ name: username });\n                    }\n                }\n                else if (action == \"unlockProject\") {\n                    console.log('User ' + username + \" unlock project \");\n                    if (this.project.info.url == args.url) { // if same project\n                        if (this._modeDisplay != \"edit\") {\n                            this.project.setAsUnlocked();\n                        }\n                        ;\n                    }\n                    ;\n                }\n                ;\n            }\n            // -- if local editor AND local user context\n            else if (this.jx.config.system.host.type == \"local\" && context == \"local\") {\n                //-- do staff for local editor\n                console.log('User (for local treatment)' + username + \"(\", context, \") make action \" + action, args);\n                if (action == \"lockProject\") {\n                    console.log('User ' + username + \" lock project \");\n                    if (this.project.info.url == args.url) { // if same project\n                        this.project.setAsLocked({ name: username });\n                    }\n                }\n                else if (action == \"unlockProject\") {\n                    console.log('User ' + username + \" unlock project \");\n                    if (this.project.info.url == args.url) { // if same project\n                        // if (this._modeDisplay != \"edit\") {\n                        this.project.setAsUnlocked();\n                        // };\n                    }\n                    ;\n                }\n                ;\n            }\n            // -- if local editor AND any user context, server or local\n            else if (this.jx.config.system.host.type == \"local\") {\n                //-- do staff for local editor\n                console.log('User (for local treatment)' + username + \"(\", context, \") make action \" + action, args);\n            }\n        });\n    }\n    _setLogs(enabled) {\n        if (enabled) {\n            this.editor.createDir(this.project.info.url + \"/logs\");\n            this.gabaritView.onchanged.add(evt => {\n                var date = new Date();\n                var dateStr = date.getFullYear() + \"-\" + Number(date.getMonth() + 1) + \"-\" + date.getDate() + \"-\" + Number(date.getHours() + 1) + \"h\" + Number(date.getMinutes() + 1) + \"m\" + Number(date.getSeconds() + 1) + \"s\";\n                console.log(\"gabarit onchanged\", evt.firstItem.data.id, \"to\", evt.firstItem.value || \"\", \"by\", this.editor.user.name, \"at\", dateStr);\n                this.jx.db.saveJSONCompressed(this.project.info.url + \"/logs/\" + dateStr + \".log\", {\n                    date: dateStr,\n                    user: this.editor.user.name,\n                    itemID: evt.firstItem.data.id,\n                    value: evt.firstItem.value || \"\"\n                });\n            });\n        }\n    }\n    _loadComps(callback) {\n        let toLoad = [];\n        this.foreachInGabarit({ gabarit: this.project.info.gabarit, func: (item) => {\n                // Text editor/plugins/Text\n                // js/src/plugins/Text\n                // jx/editor/editionitems/Text\n                // \n                // plugs.mymagiccomp.MyMagicComp\n                // $editor.plugs.mymagiccomp.MyMagicComp\n                // $project.plugs.mymagiccomp.MyMagicComp\n                //-- Editor, pour chaque type\n                //-- Déduit le composant à utiliser\n                //-- si le composant se trouve dans le dossier editor/plugins du projet (file test)\n                //-- si le composant se trouve dans le dossier js/src/plugins de l'editor (file test)\n                //-- si le composant se trouve dans le dossier jx/editor/editionitems (file test)\n                //-- jx engine, pour chaque type\n                //-- si le composant se trouve dans le dossier public/js/src\n                //-- si le composant se trouve dans le dossier jx/comps\n                //-- si le composant se trouve dans le dossier jx/core/comps\n                //\n                let path = item.type.split('.');\n                if (path[0] == \"comps\") {\n                    if (!this.jx.db.classDefined(path.join(\"/\"))) {\n                        toLoad.push({ id: item.type, type: \"class\", src: path.join(\"/\") });\n                    }\n                    ;\n                }\n                else if (path[0] == \"local\") {\n                    let url = path.join(\"/\").replace(\"local\", this.project.info.url + \"/public/js/src/editor\") + \"/Index.js\";\n                    if (!this.jx.db.classDefined(url)) {\n                        toLoad.push({ id: item.type, type: \"class\", src: url });\n                    }\n                    ;\n                }\n            } });\n        this.jx.db.addAndLoad(toLoad, callback);\n    }\n    _loadCustomComps(callback) {\n        let toLoad = [];\n        this.foreachInGabarit({ gabarit: this.project.info.gabarit, func: (item) => {\n                let path = item.type.split('.');\n                if (path[0] == \"comps\") {\n                    if (!this.jx.db.classDefined(path.join(\"/\"))) {\n                        toLoad.push({ id: item.type, type: \"class\", src: path.join(\"/\") });\n                    }\n                    ;\n                }\n                else if (path[0] == \"local\") {\n                    let url = path.join(\"/\").replace(\"local\", this.project.info.url + \"/public/js/src/editor\") + \".js\";\n                    if (!this.jx.db.classDefined(url)) {\n                        toLoad.push({ id: item.type, type: \"class\", src: url });\n                    }\n                    ;\n                }\n            } });\n        this.jx.db.addAndLoad(toLoad, callback);\n    }\n    _loadFontsList(callback) {\n        this.jx.db.addAndLoad({ id: \"ResourcesFontsList\", type: \"json\",\n            src: \"/resources/milan-presse/fonts/fonts.json\" }, evt => {\n            if (evt.resources.ResourcesFontsList.data) {\n                let json = evt.resources.ResourcesFontsList.data;\n                console.log(json);\n                this.editor.getOptionsList().fontsDefs = json.fontsList;\n                let fontsNameArr = [];\n                for (let i = 0; i < json.fontsList.length; i++) {\n                    fontsNameArr.push(json.fontsList[i].fontFamily);\n                }\n                this.editor.getOptionsList().fonts = fontsNameArr;\n            }\n            else {\n                this.editor.getOptionsList().fonts = [];\n                this.editor.getOptionsList().fontsDefs = [];\n            }\n            callback();\n        });\n    }\n    addNewTab() {\n        console.log(this.gabaritView.gabarit);\n        this.uniqTabID++;\n        let idTab = \"NEW_TAB_\" + this.uniqTabID;\n        this.gabaritView.gabarit.push({\n            id: idTab,\n            type: \"Group\",\n            children: [\n                {\n                    \"id\": \"DeleteQuiz\",\n                    \"title\": \"Supprimer ce quiz\",\n                    \"type\": \"editionitems.ButtonItem\",\n                    \"description\": \"\",\n                    \"confirmBeforeLaunch\": true,\n                    \"onclick\": () => this.deleteTab(idTab)\n                }\n            ]\n        });\n        this.save(() => {\n            this.refreshEditionView();\n        });\n    }\n    deleteTab(idTab) {\n        this.removeInGabarit({ id: idTab, gabarit: this.gabaritView.gabarit });\n        if (this.activeTab == idTab)\n            this.activeTab = null;\n        this.save(() => {\n            this.refreshEditionView();\n        });\n    }\n    showTab(idTab) {\n        $('.nav-tabs a[href=\"#' + idTab + '\"]').tab('show');\n    }\n    changeTitleTab(idTab, title) {\n        $('.nav-tabs a[href=\"#' + idTab + '\"]').html(title);\n    }\n    testBtnDev() {\n        var list = this.jx.loadedPlugs;\n        var result = \"require([\";\n        console.log(list);\n        for (var i = 0; i < list.length; i++) {\n            result += `\"${list[i].src}\"${(i == list.length - 1 ? \"\" : \",\")}` + \"\\n\";\n            // result+= `import ${list[i].id} from \"${list[i].src}\"` + \"\\n\";\n        }\n        console.log(result);\n    }\n    _setRemoteDeamon() {\n        this._deamon = this.cc({\n            type: \"Daemon\",\n            interval: 30000,\n            func: evt => {\n                this.project.refreshLocks({\n                    url: this.project.info.url,\n                    user: this.editor.user,\n                    lock: this._modeDisplay == \"edit\" || null\n                });\n            }\n        });\n        this._deamon.start();\n    }\n    /**\n    *\n    */\n    hasAccess(functionnality) {\n        if (!this.project.hasFunctionnality(functionnality))\n            return false;\n        if (this.editor.user.group == \"admin\")\n            return true;\n        var arr = userAccess[functionnality].split(\",\");\n        return this.jx.editor.userIsGroup(...arr);\n        // for (var i = 0; i < arr.length; i++) {\n        // \tif (arr[i].trim() == this.editor.user.group) return true;\n        // }\n        // return false;\n    }\n    showInfo() {\n        this.mainMenu.btInfosToggle(false);\n        this.gabaritView.showAllInfos();\n    }\n    hideInfo() {\n        this.mainMenu.btInfosToggle(true);\n        this.gabaritView.hideAllInfos();\n    }\n    unfoldTexts() {\n        this.mainMenu.btUnfoldTextsToggle(false);\n        this.gabaritView.textFold = false;\n    }\n    foldTexts() {\n        this.mainMenu.btUnfoldTextsToggle(true);\n        this.gabaritView.textFold = true;\n    }\n    readMode() {\n        if (this._modeDisplay == \"edit\") {\n            this.editor.host.io.emit('userAction', {\n                username: this.editor.user.name,\n                context: this.jx.config.system.host.type,\n                action: \"unlockProject\",\n                args: { url: this.project.info.url }\n            });\n        }\n        ;\n        this.project.unlock(evt => {\n            console.log(evt);\n            this._modeDisplay = \"read\";\n            // this.mainMenu.unlockProject2();\n            this.gabaritView.lock = true;\n        });\n    }\n    editMode() {\n        // if permanentLock is set in json\n        if (this.project.info.permanentLock\n            && !this.editor.userIsGroup(this.project.info.permanentLock)\n            && this.editor.user.name != this.project.info.permanentLock) {\n            // this.mainMenu.lockProjectByUser(this.project.info.permanentLock);\n            this.editor.popup({\n                title: \"Edition bloquée\",\n                content: `Le projet ${this.project.info.id}  est en cours de dev et bloqué par ${this.project.info.permanentLock}. \n\t\t\t\t`\n            });\n        }\n        else {\n            this.project.lock(evt => {\n                switch (evt.result) {\n                    case \"success\":\n                        this._modeDisplay = \"edit\";\n                        this.editor.host.io.emit('userAction', {\n                            username: this.editor.user.name,\n                            context: this.jx.config.system.host.type,\n                            action: \"lockProject\",\n                            args: { url: this.project.info.url }\n                        });\n                        this.reload(evt => {\n                            this.gabaritView.lock = false;\n                        });\n                        break;\n                    case \"locked\":\n                        // this.mainMenu.lockProjectByUser(evt.user.name);\n                        this.editor.popup({\n                            title: \"Edition bloquée\",\n                            content: `Le projet ${this.project.info.id}  est déjà en cours d'édition par ${evt.user.name}. <br/>\n\t\t\t\t\t\t\t\tRéessayez quand il aura fini ou demandez lui de débloquer le projet.`\n                        });\n                        console.log(\"Project\", this.project.info.id, \"already locked by\", evt.user.name);\n                        break;\n                }\n            });\n        }\n    }\n    /** Refresh edition items list view */\n    refreshEditionView() {\n        this.gabaritView.gabarit = this.project.info.gabarit; // needed after reload (todo: check why binding not acting here)\n        this.gabaritView.refreshView();\n        $('.nav-tabs a').on('shown.bs.tab', (event) => {\n            this.activeTab = $(event.target).attr(\"href\").replace(\"#\", \"\");\n            this.activeTabParams[this.activeTab] = this.activeTabParams[this.activeTab] || { scroll: 0 };\n            this.gabaritView.editView.find(\"#mapcontent\").scrollTop(this.activeTabParams[this.activeTab].scroll);\n        });\n        this.activeTab = this.activeTab || \"Informations\";\n        this.showTab(this.activeTab);\n        if (this.gabaritView.modeDisplay == \"tab\") {\n            $(\"body\").css(\"overflow\", \"hidden\");\n        }\n        else {\n            $(\"body\").css(\"overflow\", \"auto\");\n        }\n        let top = $(\"#MainTopMenu\").position().top + $(\"#MainTopMenu\").outerHeight();\n        $(\"#myScrollspy\").css(\"top\", (top) + \"px\");\n        $(\"#mapcontent\").css(\"top\", (top) + \"px\");\n        $(\"#myScrollspy\").height($(window.top).height() - top);\n        $(\"#myScrollspy\").css(\"overflow\", \"auto\");\n        $(\"#mapcontent\").height($(window.top).height() - top);\n        $(\"#mapcontent\").css(\"overflow\", \"auto\");\n        $(window).on(\"resize\", () => {\n            let top = $(\"#MainTopMenu\").position().top + $(\"#MainTopMenu\").outerHeight();\n            $(\"#myScrollspy\").css(\"top\", top + \"px\");\n            $(\"#mapcontent\").css(\"top\", top + \"px\");\n            $(\"#myScrollspy\").height($(window.top).height() - top);\n            $(\"#myScrollspy\").css(\"overflow\", \"hidden\");\n            $(\"#mapcontent\").height($(window.top).height() - top);\n            $(\"#mapcontent\").css(\"overflow\", \"hidden\");\n            this.jx.wait(0, () => {\n                $(\"#myScrollspy\").css(\"overflow\", \"auto\");\n                $(\"#mapcontent\").css(\"overflow\", \"auto\");\n            });\n        });\n        this.setGabaritEditor();\n        this.activeTabParams[this.activeTab] = this.activeTabParams[this.activeTab] || { scroll: 0 };\n        this.gabaritView.editView.find(\"#mapcontent\").scrollTop(this.activeTabParams[this.activeTab].scroll);\n    }\n    /** Reload project and refresh view */\n    reload(callback) {\n        this.jx.loadingScreen.show();\n        this.project.load(evt => {\n            //console.log(this.project);\n            this._loadCustomComps(() => {\n                this.refreshEditionView();\n                this.jx.loadingScreen.hide();\n                callback();\n            });\n        });\n    }\n    showScreen(screenID) {\n        this.project.preview(null, screenID); /* used ? not good place */\n    }\n    //___________________________________________________________________________\n    // ITEMS GENERATION FUNCTIONS\n    /** show preview of item */\n    showItem(itemData) {\n        if (itemData.type == \"DataObject\" || itemData.type == \"FlashtmlPack\") {\n            this.project.previewDev(itemData.id); /* used ? not good place */\n            return;\n        }\n        ;\n        switch (itemData.asset.type) {\n            case \"ImageSequence\":\n                //this.editor.previewDev(this.appData, itemData.id)\n                var win = window.open(\"/editor/viewer/public/?id=\" + itemData.id + \"&type=ImageSequence&start=\" + itemData.asset.start + \"&end=\" + itemData.asset.end + \"&src=\" + encodeURIComponent(this.project.info.url + \"/public/assets/\" + itemData.asset.src), \"_blank\");\n                break;\n            case \"Flashtml\":\n                var win = window.open(\"/editor/viewer/public/?id=\" + itemData.id + \"&type=Flashtml&src=\" + encodeURIComponent(this.project.info.url + \"/public/assets/\" + itemData.asset.src), \"_blank\");\n                break;\n            case \"Video\":\n                console.log(this.project.info.url + \"/public/\" + itemData.asset.src);\n                var win = window.open(\"\", \"_blank\");\n                var content = `\n\t\t\t\t\t<video controls preload >\n\t\t\t\t\t\t<source src= \"${this.project.info.url + \"/public/assets/\" + itemData.asset.src}\", type= 'video/mp4; codecs=avc1.42E01E,mp4a.40.2' />\n\t\t\t\t\t</video>\n\t\t\t\t`;\n                win.document.write(\"<head><title>\" + itemData.id + \"</title></head><body style='background-color:#EEEEEE'>\" + content + \"</body>\");\n                win.document.close();\n                break;\n            case \"Sound\":\n                console.log(this.project.info.url + \"/public/\" + itemData.asset.src);\n                var win = window.open(\"\", \"_blank\");\n                var src = (this.project.info.url + \"/public/assets/\" + itemData.asset.src).replace(\"${lang}\", this.lang);\n                win.document.write(\"<head><title>\" + itemData.id + \"</title></head><body><h1>\" + itemData.id + \"</h1><audio autoplay controls src='\" + src + \"' /></body>\");\n                win.document.close();\n                break;\n            case \"Image\":\n                console.log(this.project.info.url + \"/public/\" + itemData.asset.src);\n                var win = window.open(\"\", \"_blank\");\n                win.document.write(\"<head><title>\" + itemData.id + \"</title></head><body style='background-color:#EEEEEE'><img  src='\" + this.project.info.url + \"/public/assets/\" + itemData.asset.src + \"' /></body>\");\n                win.document.close();\n                break;\n            case \"PSD\":\n            case \"FLA\":\n            case \"PDF\":\n                console.log(this.project.info.url + \"/public/\" + itemData.asset.src, itemData.id);\n                var win = window.open(this.project.info.url + \"/public/assets/\" + itemData.asset.src, itemData.id);\n                win.document.title = itemData.id;\n                break;\n            default:\n                console.warn(\"preview for type: \", itemData.asset.type, \" not exists\");\n                break;\n        }\n    }\n    /** download item */\n    downloadItem(itemData) {\n        var src = (this.project.info.url + \"/public/assets/\" + itemData.asset.src).replace(\"${lang}\", this.lang);\n        this.editor.download({\n            url: src,\n            prefixZip: this.project.info.id,\n            internPath: src.split(\"/\").pop()\n        });\n    }\n    /** download item */\n    deleteItemLinkedFile(itemData, callback = evt => { }) {\n        console.log(\"deleteItemLinkedFile\", itemData);\n        var src = (this.project.info.url + \"/public/assets/\" + itemData.asset.src).replace(\"${lang}\", this.lang);\n        this.editor.deleteFile(src, evt => {\n            console.log(\"edition deleted\", evt);\n            callback(evt);\n        });\n    }\n    /** open parent directory containing item */\n    openParentDirectory(itemData) {\n        var src = (this.project.info.url + \"/public/assets/\" + itemData.asset.src).replace(\"${lang}\", this.lang);\n        let urlArray = src.split(\"/\");\n        urlArray.pop();\n        let parentDirURL = urlArray.join(\"/\");\n        this.editor.openFile({\n            url: parentDirURL\n        });\n    }\n    pushFile(itemData) {\n        console.log(\"push\", itemData);\n    }\n    pullFile(itemData) {\n        console.log(\"pull\", itemData);\n    }\n    /** */\n    getInGabarit({ id, gabarit }) {\n        gabarit = gabarit || this.project.info.gabarit;\n        console.log(id);\n        console.log(gabarit);\n        for (var i = 0; i < gabarit.length; i++) {\n            console.log(gabarit[i].id);\n            if (gabarit[i].id == id) {\n                console.log(\"FOUND\");\n                return gabarit[i];\n            }\n            else if (gabarit[i].type == \"Group\") {\n                console.log(\"Group\", gabarit[i].id);\n                var childrenG = this.getInGabarit({ id: id, gabarit: gabarit[i].children });\n                if (childrenG != null) {\n                    return this.getInGabarit({ id: id, gabarit: gabarit[i].children });\n                }\n                ;\n            }\n        }\n        ;\n        return null;\n    }\n    /** */\n    foreachInGabarit({ gabarit, func }) {\n        //console.log(\"getInGabaritByType\", type)\n        gabarit = gabarit || this.project.info.gabarit;\n        let results = [];\n        for (var i = 0; i < gabarit.length; i++) {\n            //console.log(gabarit[i].type, type)\n            func(gabarit[i]);\n            if (gabarit[i].children) {\n                //console.log(\"Group\",gabarit[i].type)\n                var childrenG = this.foreachInGabarit({ gabarit: gabarit[i].children, func });\n            }\n        }\n        ;\n    }\n    /** */\n    getInGabaritByType({ type, gabarit = this.project.info.gabarit }) {\n        //console.log(\"getInGabaritByType\", type)\n        // gabarit = gabarit || this.project.info.gabarit;\n        let results = [];\n        for (var i = 0; i < gabarit.length; i++) {\n            //console.log(gabarit[i].type, type)\n            if (gabarit[i].type == type) {\n                //console.log(\"FOUND\")\n                results.push(gabarit[i]);\n            }\n            else if (gabarit[i].children) {\n                //console.log(\"Group\",gabarit[i].type)\n                var childrenG = this.getInGabaritByType({ type: type, gabarit: gabarit[i].children });\n                if (childrenG != null) {\n                    results = results.concat(childrenG);\n                }\n                ;\n            }\n        }\n        ;\n        return results;\n    }\n    /** */\n    removeInGabarit({ id, gabarit }) {\n        gabarit = gabarit || this.project.info.gabarit;\n        console.log(id);\n        console.log(gabarit);\n        for (var i = 0; i < gabarit.length; i++) {\n            console.log(gabarit[i].id);\n            if (gabarit[i].id == id) {\n                console.log(\"FOUND\");\n                gabarit.splice(i, 1);\n                return true;\n            }\n            else if (gabarit[i].type == \"Group\") {\n                console.log(\"Group\", gabarit[i].id);\n                var childrenG = this.getInGabarit({ id: id, gabarit: gabarit[i].children });\n                if (childrenG != null) {\n                    return this.getInGabarit({ id: id, gabarit: gabarit[i].children });\n                }\n                ;\n            }\n        }\n        ;\n        return false;\n    }\n    //___________________________________________________________________________\n    // PROJECT ACTIONS\n    generateFontsListCSS() {\n        let fontList = this.getInGabaritByType({ type: \"TextStyle2\" });\n        let resultCSS = \"\";\n        let parsed = [];\n        for (var i = 0; i < fontList.length; i++) {\n            let fontFamily = fontList[i].value.fontFamily + \"-\" + fontList[i].value.fontStyle;\n            if (parsed.indexOf(fontFamily) !== -1)\n                continue;\n            parsed.push(fontFamily);\n            let fontCSS = `@font-face {\n\t\t\t  font-family: '${fontFamily}';\n\t\t\t  src: url('../assets/fonts/${fontFamily}/${fontFamily}.eot');\n\t\t\t  src: url('../assets/fonts/${fontFamily}/${fontFamily}.woff2') format('woff2'),\n\t\t\t       url('../assets/fonts/${fontFamily}/${fontFamily}.woff') format('woff'),\n\t\t\t       url('../assets/fonts/${fontFamily}/${fontFamily}.ttf') format('truetype'),\n\t\t\t       url('../assets/fonts/${fontFamily}/${fontFamily}.svg#${fontFamily}') format('svg'),\n\t\t\t       url('../assets/fonts/${fontFamily}/${fontFamily}.eot?#iefix') format('embedded-opentype');\n\t\t\t  font-weight: normal;\n\t\t\t  font-style: normal;\n\t\t\t}\n\t\t\t`;\n            resultCSS += fontCSS + \"\\n\\n\";\n        }\n    }\n    /** save project */\n    save(callback = () => { }) {\n        console.log(\"save\");\n        this.project.refreshInfo();\n        this.generateFontsListCSS();\n        //--- refresh window titles view\n        let title = (this.project.info.title && this.project.info.title.trim() != \"\")\n            ? this.project.info.title\n            : this.project.info.id;\n        $('title').html(title);\n        this.mainMenu.setProjectTitle(title);\n        if (this.editView.find(\"#gabaritEditorBox\").css(\"display\") == \"none\") { // gabarit json editor is closed\n            this.exportConfig(callback);\n        }\n        else { // gabarit json editor is opened\n            //-- if there're syntaxes errors in json, goto first error line and alert\n            if (this._gabaritEditorErrors.length > 0) {\n                var annot = this.gabaritEditor.getSession().getAnnotations();\n                var content = [];\n                for (var key in annot) {\n                    content.push(annot[key].text + \"on line \" + \" \" + annot[key].row);\n                }\n                this.editor.popup({\n                    title: \"There are some errors\",\n                    content: content.join(\"\\n\"),\n                    onclose: evt => {\n                        // do nothing\n                    }\n                });\n                this.gabaritEditor.gotoLine(annot[key].row);\n            }\n            else { //-- no errors, saves, reload and re-open gabarit editor in same state.\n                this.saveGabaritIntern(() => this.reload(() => {\n                    this.exportConfig(() => {\n                        this.gabaritEditorLastPosition = this.gabaritEditorLastPosition || { row: 0, column: 1 };\n                        this.gabaritEditor.resize(true);\n                        this.gabaritEditor.moveCursorTo(this.gabaritEditorLastPosition.row + 1, this.gabaritEditorLastPosition.column + 1);\n                        this.gabaritEditor.gotoLine(this.gabaritEditorLastPosition.row);\n                        // this.gabaritEditor.moveCursorTo(this.gabaritEditorLastPosition.row,this.gabaritEditorLastPosition.column);\n                        // this.gabaritEditor.gotoLine(this.gabaritEditorLastPosition.row);\n                        //this.gabaritEditor.navigateTo(this.gabaritEditorLastPosition.row,this.gabaritEditorLastPosition.column);\n                        if (callback) {\n                            callback();\n                        }\n                    });\n                }));\n            }\n        }\n    }\n    /** save project */\n    saveFromJSONEDitor(callback) {\n        this.save(evt => {\n            this.editGabarit();\n        });\n    }\n    /** */\n    exportConfig(callback) {\n        try {\n            let jsonObj = JSON.parse(JSON.stringify(this.project.info.gabarit));\n            this.project.save(evt => {\n                this.loadGabaritIntern(() => {\n                    if (callback) {\n                        callback();\n                    }\n                });\n            });\n        }\n        catch (err) {\n            console.log(this.project.info.gabarit);\n            alert(\"Project can't be saved. an error occurs in json: \" + err.message);\n            this.reload(() => { });\n        }\n    }\n    /** open json editor on editor.json */\n    editGabaritExtern() {\n        var win = window.open(\"/editor/jsoneditor/?src=\" + encodeURIComponent(this.project.info.url + \"/etc/editor/editor.json\"), \"_blank\");\n    }\n    _showGabaritEditor() {\n        this.menuTop.hideComponent(\"pagesTabs\");\n        window.scrollTo(0, 0);\n        // document.body.style.overflow = 'hidden';\n        this.mainMenu.btGabaritJSONEditorToggle(true);\n        this.editView.find(\"#gabaritEditorBox\").css(\"display\", \"inline\");\n        this.gabaritEditorLastPosition = this.gabaritEditorLastPosition || { row: 0, column: 1 };\n        this.gabaritEditor.resize(true);\n        this.gabaritEditor.moveCursorTo(this.gabaritEditorLastPosition.row, this.gabaritEditorLastPosition.column);\n        this.gabaritEditor.gotoLine(this.gabaritEditorLastPosition.row);\n    }\n    _hideGabaritEditor() {\n        // document.body.style.overflow = 'auto';\n        this.editView.find(\"#gabaritEditorBox\").css(\"display\", \"none\");\n        this.menuTop.showComponent(\"pagesTabs\");\n        this.mainMenu.btGabaritJSONEditorToggle(false);\n    }\n    /** */\n    editGabarit() {\n        let gabaritIsVisible = this.editView.find(\"#gabaritEditorBox\").css(\"display\") != \"none\";\n        if (gabaritIsVisible) {\n            this._hideGabaritEditor();\n        }\n        else {\n            this._showGabaritEditor();\n        }\n    }\n    /** */\n    showInGabarit(search, { backwards = false, wrap = false, caseSensitive = false, wholeWord = false, regExp = false } = {}) {\n        let gabaritIsVisible = this.editView.find(\"#gabaritEditorBox\").css(\"display\") != \"none\";\n        if (gabaritIsVisible) {\n            this._hideGabaritEditor();\n        }\n        else {\n            this._showGabaritEditor();\n            // Find options\n            // needle: The string or regular expression you're looking for\n            // backwards: Whether to search backwards from where cursor currently is. Defaults to false.\n            // wrap: Whether to wrap the search back to the beginning when it hits the end. Defaults to false.\n            // caseSensitive: Whether the search ought to be case-sensitive. Defaults to false.\n            // wholeWord: Whether the search matches only on whole words. Defaults to false.\n            // range: The Range to search within. Set this to null for the whole document\n            // regExp: Whether the search is a regular expression or not. Defaults to false.\n            // start: The starting Range or cursor position to begin the search\n            // skipCurrent: Whether or not to include the current line in the search. Default to false.\n            this.gabaritEditor.find(search, { backwards, wrap, caseSensitive, wholeWord, regExp });\n            this.gabaritEditor.findNext();\n        }\n    }\n    get editView() {\n        return this.gabaritView.editView;\n    }\n    /** */\n    setGabaritEditor() {\n        //this.gabaritEditor = this.cc({type: \"EditorCode\", mainView: this.editView.find(\"#gabaritEditorBox\")})\n        this.editView.find(\"#gabaritEditorBox\").find(\"#search\").on(\"input\", evt => {\n            console.log(evt);\n            /*\n            The following options are available to you for your search parameters:\n            - needle: The string or regular expression you're looking for\n            - backwards: Whether to search backwards from where cursor currently is. Defaults to false.\n            - wrap: Whether to wrap the search back to the beginning when it hits the end. Defaults to false.\n            - caseSensitive: Whether the search ought to be case-sensitive. Defaults to false.\n            - wholeWord: Whether the search matches only on whole words. Defaults to false.\n            - range: The Range to search within. Set this to null for the whole document\n            - regExp: Whether the search is a regular expression or not. Defaults to false.\n            - start: The starting Range or cursor position to begin the search\n            - skipCurrent: Whether or not to include the current line in the search. Default to false.\n            */\n            if (evt.target.value.search(/^\\$[0-9]+$/) != -1) {\n                this.gabaritEditor.gotoLine(Number(evt.target.value.replace(/^\\$/, \"\")));\n            }\n            else {\n                this.gabaritEditor.find(evt.target.value, {\n                    backwards: false,\n                    wrap: true,\n                    caseSensitive: false,\n                    wholeWord: false,\n                    regExp: false\n                });\n            }\n        });\n        this.editView.find(\"#gabaritEditorBox\").find(\"#searchNext\").on(\"click\", evt => {\n            console.log(evt);\n            this.gabaritEditor.findNext();\n        });\n        this.editView.find(\"#gabaritEditorBox\").find(\"#searchPrevious\").on(\"click\", evt => {\n            console.log(evt);\n            this.gabaritEditor.findPrevious();\n        });\n        let snippetsLib = new Snippets();\n        let snippets = snippetsLib.getAll();\n        snippets.unshift({ id: \"- Snippets -\", value: \"\" });\n        let optionCB;\n        let snippetsDOM = this.editView.find(\"#gabaritEditorBox\").find(\"#snippetsBtns\");\n        snippetsDOM.append('<select class=\"form-control\" id=\"snippetsSelect\">');\n        for (var i = 0; i < snippets.length; i++) {\n            optionCB = snippets[i];\n            var el = document.createElement(\"option\");\n            if (typeof optionCB == \"string\") {\n                el.textContent = optionCB;\n                el.value = optionCB;\n            }\n            else {\n                el.textContent = optionCB.desc || optionCB.id;\n                el.value = optionCB.id;\n            }\n            el.title = snippetsLib.getSnippet(el.value).value;\n            el.addEventListener(\"mouseover\", function (evt) {\n                console.log(evt);\n            });\n            $(el).attr(\"disabled\", i == 0);\n            $(el).attr(\"selected\", false);\n            snippetsDOM.find(\"#snippetsSelect\").append(el);\n        }\n        snippetsDOM.find(\"#snippetsSelect\")[0].selectedIndex = 0;\n        snippetsDOM.on(\"change\", (event) => {\n            this.gabaritEditor.insert(snippetsLib.getSnippet(event.target.value).value);\n            snippetsDOM.find(\"#snippetsSelect\")[0].selectedIndex = 0;\n        });\n        this.editView.find(\"#gabaritEditor\").css('position', \"absolute\");\n        this.gabaritEditor = ace.edit(\"gabaritEditor\");\n        this.gabaritEditor.setOptions({\n            wrap: true\n            //maxLines: Infinity\n        });\n        this.gabaritEditor.$blockScrolling = Infinity; // because ace console warning: Automatically scrolling cursor into view after selection change this will be disabled in the next version set editor.$blockScrolling = Infinity to disable this message\n        //this.gabaritEditor.setFontSize(10);\n        this.gabaritEditor.setTheme(\"ace/theme/eclipse\");\n        this.gabaritEditor.setShowFoldWidgets(true);\n        this.gabaritEditor.getSession().setMode(\"ace/mode/json\");\n        this.gabaritEditor.getSession().on(\"changeAnnotation\", () => {\n            this._gabaritEditorErrors = this.gabaritEditor.getSession().getAnnotations();\n        });\n        //this.gabaritEditor.$blockScrolling = Infinity;\n        var jsonResource = this.project.getJSON();\n        this.gabaritEditor.setValue(JSON.stringify(jsonResource, null, 4));\n        this.gabaritEditorLastPosition = this.gabaritEditorLastPosition || { row: 0, column: 1 };\n        this.gabaritEditor.moveCursorToPosition(this.gabaritEditorLastPosition);\n        // this.editView.find(\"#saveGabarit\").click(()=>{\n        // \tthis.saveGabaritIntern(()=>this.reload());\n        // })\n    }\n    /** */\n    openGabaritIntern() {\n        var win = window.open(\"/editor/jsoneditor/?src=\" + encodeURIComponent(this.project.info.url + \"/etc/editor/editor.json\"), \"_blank\");\n    }\n    /** */\n    saveGabaritIntern(callback) {\n        var fileURL = this.project.info.configPath;\n        //console.log(\"saveGabaritIntern\", this.gabaritEditor.getValue());\n        this.jx.db.saveText(fileURL, this.gabaritEditor.getValue(), () => {\n            this.gabaritEditorLastPosition = this.gabaritEditor.getCursorPosition();\n            callback();\n        });\n    }\n    /** */\n    loadGabaritIntern(callback = function () { }) {\n        this.jx.db.loadText(this.project.info.configPath, (result) => {\n            this.gabaritEditor.setValue(result);\n            callback();\n        });\n    }\n    /** generate reports of project */\n    report() {\n        let popupContent = $(`\n\t\t<div class=\"white-popup\">\n\t\t\t<form role=\"form\" id=\"buildForm\">\n\t    \t<div class=\"form-group\">\n\t\t\t<div class=\"checkbox\">\n\t\t    \t<label><input type=\"checkbox\" id=\"sound\" checked>Sons</label>\n\t\t    \t<label><input type=\"checkbox\" id=\"text\" >Textes</label>\n\t\t  \t</div>\n\t\t  \t</div>\n\t\t  <!--\t<div class=\"form-group\">\n\t\t\t<div class=\"checkbox\">\n\t\t    \t<label><input type=\"checkbox\"  id=\"sound\">sounds</label>\n\t\t  \t</div>\n\t\t  \t</div>-->\n\t\t  \t<button type=\"button\" class=\"btn btn-default\" title=\"Informations\" id=\"valider\">Valider</button>\n\t\t  \t </form>\n\n\t\t </div>\n\t\t`);\n        $.magnificPopup.open({\n            items: {\n                src: popupContent,\n                type: 'inline'\n            }\n        });\n        popupContent.find(\"#valider\").click(() => {\n            console.log(\"valider\");\n            $.magnificPopup.close();\n            var arr = popupContent.find(\":checkbox\");\n            for (var i = 0; i < arr.length; i++) {\n                console.log(\"OK\", $(arr[i]).prop(\"checked\"));\n                if (arr[i].checked) {\n                    console.log(\"OK\", $(arr[i]).attr(\"id\"));\n                    switch ($(arr[i]).attr(\"id\")) {\n                        case \"sound\":\n                            this.editor.generateReport({ type: \"sound\", projectData: this.project.info });\n                            break;\n                        case \"text\":\n                            this.editor.generateReport({ type: \"text\", projectData: this.project.info });\n                            break;\n                        case \"fullproject\":\n                            // TODO\t\n                            break;\n                    }\n                }\n            }\n            ;\n            console.log(arr);\n        });\n        //editor.downloadBuild({url: this.project.info.url, id: this.appData.id});\n    }\n}\n"]}