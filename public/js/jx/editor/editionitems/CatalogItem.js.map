{"version":3,"sources":["../../../../src/jx/editor/editionitems/CatalogItem.js"],"names":["access","project","preview","edit","view","delete","moveToArchives","exportProject","model","appengine","archive","component","doc","CatalogItem","dataObject","controller","data","Object","assign","id","title","url","status","description","trim","statusStyle","order","todo","test","debug","doing","open","done","close","statusStyleCSS","iconStyle","search","replace","datePublicationStr","datePublication","date","Date","jx","tools","gd","getDate","getMonth","getFullYear","_template","toUpperCase","item","$","prop","me","find","each","index","css","_hasAccess","click","action","event","currentTarget","console","log","editor","editProject","type","getDirectoryURL","win","window","previewIndex","openURL","projectURL","createNewProjectDialog","modelData","refreshList","newProjectData","popup","content","buttons","ok","label","no","onclose","evt","popup2","alert","closable","moveProject","targetID","modal","deleteProjectDial","idFunctionnality","userIsGroup","toLowerCase","split","appData","sendToTest"],"mappings":"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","file":"CatalogItem.js","sourcesContent":["import VisualComponent from \"jx/core/comps/VisualComponent\";\nlet access = {\n    project: {\n        preview: \"*\",\n        edit: \"*\",\n        view: \"*\",\n        \"new\": \"admin,manager,dev\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"admin,manager,dev\",\n        exportProject: \"\" // TODO: exportProject can not be put on home page anymore (will need instanciation of light version of ApplicationBabelHTML5 class).  This is accessible in edition page only.\n    },\n    model: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"*\",\n        delete: \"admin,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    appengine: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"*\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    archive: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"admin,manager,dev\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    component: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"admin,dev\",\n        delete: \"admin,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    doc: {\n        preview: \"*\",\n        edit: \"\",\n        view: \"\",\n        \"new\": \"\",\n        delete: \"\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    }\n};\nexport default class CatalogItem extends VisualComponent {\n    constructor(dataObject) {\n        super(dataObject);\n        // console.log(\"CatalogItem2 constr\", dataObject, this.dataObject);\n        this.controller = this.dataObject.controller;\n        this.data = Object.assign({\n            id: null,\n            title: null,\n            url: null,\n            status: \"all\",\n            description: \"\"\n        }, this.data);\n        var title = this.data.id;\n        if (this.data.title && this.data.title.trim() != \"\") {\n            title = `${this.data.id} (${this.data.title})`;\n        }\n        let statusStyle = {\n            \"new\": \"css->background-color: #ffff00; color: #000000\", order: \"danger\", todo: \"danger\", \"dev-tovalidate\": \"danger\", \"dev-confirmed\": \"success\", \"R&D\": \"warning\", test: \"info\", debug: \"warning\",\n            doing: \"warning\", open: \"warning\", done: 'success', close: 'success'\n        }[this.data.status] || \"info\";\n        let statusStyleCSS = \"\";\n        let iconStyle = {\n            \"new\": \"fa-star\", order: \"fa-list-alt\", todo: \"fa-exclamation-triangle\", test: \"fa-flask\", \"R&D\": \"fa-flask\",\n            debug: \"fa-bug\", open: \"fa-cogs\", doing: \"fa-cogs\", done: 'fa-check-circle',\n            close: 'fa-check-circle'\n        }[this.data.status];\n        if (statusStyle.search(/^css->/) != -1) {\n            statusStyleCSS = statusStyle.replace(/^css->/, \"\");\n            statusStyle = \"info\";\n        }\n        let datePublicationStr = \"\";\n        if (this.data.datePublication != \"\") {\n            let date = new Date(this.data.datePublication);\n            // console.log(\"date\", date)\n            datePublicationStr = \"pub: \" + jx.tools.gd(date.getDate(), 2) + \"/\" + jx.tools.gd(date.getMonth() + 1, 2) + \"/\" + date.getFullYear();\n        }\n        let _template = `\n            <div class=\"panel panel-info paddingItem\">\n                <div class=\"row \">\n                    <div class=\"col-sm-4\">\n                        <h3 class=\"panel-title \">${title}</h3>\n                        <span class=\"label label-${statusStyle}\" style=\"${statusStyleCSS}\">\n                            <span class=\"fa ${iconStyle}\">\n                                <span class=\"catalogItemStatus\">${this.data.status.toUpperCase()}</span>\n                            </span>\n                        </span>\n                        <span style=\"position: absolute;left: 100px;\">${datePublicationStr}</span> \n                    </div>\n                    <div class=\"col-sm-4\" id=\"buttons\">\n                        <button id=\"preview\" class=\"btn btn-default\" title=\"Voir\"><span class=\"fa fa-eye\"></span></button>\n                        <button id=\"edit\" class=\"btn btn-default\" title=\"Editer\"><span class=\"fa fa-pencil-square-o\"></span></button>\n                        <button id=\"exportProject\" class=\"btn btn-default\" title=\"Créer/Télecharger un build\"><span class=\"fa fa-download\"></span></button>\n                        <button id=\"new\" class=\"btn btn-default\" title=\"Créer un nouveau projet à partir de celui çi\"><span class=\"fa fa-plus-square-o\"></span></button>\n                        <button id=\"moveToArchives\" class=\"btn btn-default\" title=\"Archiver le projet\"><span class=\"fa fa-arrow-right\"></span><span class=\"fa fa-archive\"></span></button>\n                    </div>\n                    <div class=\"col-sm-4\">\n                        <button id=\"delete\" class=\"btn btn-default\" title=\"Supprimer le projet\"><span class=\"fa fa-trash-o\"></span></button>\n                    </div>\n                </div>\n                <div class=\"row \">\n                    <div class=\"col-sm-12\">\n                        <div id=\"description\">${this.data.description}</div>\n                    </div>\n                </div>\n            </div>\n        `;\n        var item = $(_template);\n        item.prop('id', this.data.id);\n        var me = this;\n        item.find(\"button\").each(function (index) {\n            $(this).css(\"display\", (me._hasAccess($(this).prop('id')) ? \"inline\" : \"none\"));\n        });\n        item.find(\"button\").data(this.data);\n        item.find(\"button\").click(event => {\n            var action = $(event.currentTarget).prop('id');\n            var data = $(event.currentTarget).data();\n            console.log(action, data);\n            switch (action) {\n                case \"edit\":\n                    this.jx.editor.editProject({\n                        id: data.id,\n                        url: data.url\n                    });\n                    break;\n                case \"preview\":\n                    if (data.type == \"Doc\") {\n                        let url = (data.url.search(/^http/) == -1) ? this.jx.editor.getDirectoryURL(\"docsURL\") + \"/\" + data.url : data.url;\n                        let win = window.open(url);\n                    }\n                    else {\n                        let url = data.url + \"/public\";\n                        url = (this.data.previewIndex != \"\") ? url + \"/\" + data.previewIndex : url;\n                        this.jx.tools.openURL(url, data.id);\n                    }\n                    break;\n                case \"exportProject\":\n                    this.jx.editor.exportProject({\n                        id: data.id,\n                        projectURL: data.url\n                    });\n                    break;\n                case \"new\":\n                    this.jx.editor.createNewProjectDialog({ modelData: data }, newProjectData => {\n                        this.controller.refreshList();\n                        this.jx.editor.editProject({\n                            id: newProjectData.id,\n                            url: newProjectData.url\n                        });\n                    });\n                    break;\n                case \"moveToArchives\":\n                    this.jx.editor.popup({ title: \"Comfirmation de l'envoi en Archives\",\n                        content: \"Attention, cette action va fermer et archiver ce projet.\\n Etes-vous sûr ?\",\n                        buttons: {\n                            ok: { label: \"Oui\" },\n                            no: { label: \"Non\" }\n                        },\n                        onclose: evt => {\n                            if (evt.action == \"ok\") {\n                                var popup2 = this.jx.editor.alert({ title: \"Opération en cours\", content: \"Veuillez patienter svp...\", closable: false });\n                                this.jx.editor.moveProject({\n                                    url: data.url,\n                                    targetID: \"archives\"\n                                }, evt => {\n                                    this.controller.refreshList();\n                                    popup2.modal('hide');\n                                });\n                            }\n                        }\n                    });\n                    break;\n                case \"delete\":\n                    this.jx.editor.deleteProjectDial({ id: data.id, url: data.url }, evt => {\n                        this.controller.refreshList();\n                    });\n                    break;\n            }\n        });\n        this.view = item;\n    }\n    _hasAccess(idFunctionnality) {\n        // console.log(\"_hasAccess\", idFunctionnality, this.data.type)\n        return this.jx.editor.userIsGroup(...access[this.data.type.toLowerCase()][idFunctionnality].split(\",\"));\n    }\n    /** Export project */\n    _moveToArchivesDial(appData) {\n        this.jx.editor.popup({ title: \"Comfirmation de l'envoi en Archives\",\n            content: \"Attention, cette action va fermer et archiver ce projet.\\n Etes-vous sûr ?\",\n            buttons: {\n                ok: { label: \"Oui\" },\n                no: { label: \"Non\" }\n            },\n            onclose: evt => {\n                if (evt.action == \"ok\") {\n                    var popup2 = this.jx.editor.alert({ title: \"Opération en cours\", content: \"Veuillez patienter svp...\", closable: false });\n                    this.sendToTest(null, evt => {\n                        popup2.modal('hide');\n                    });\n                }\n            }\n        });\n    }\n}\n"]}