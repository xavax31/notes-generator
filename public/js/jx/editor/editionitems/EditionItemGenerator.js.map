{"version":3,"sources":["../../../../src/jx/editor/editionitems/EditionItemGenerator.js"],"names":["self","texts","variante","viewsModels","tab","flat","ItemShorcutsNames","EditionItemGenerator","dataObject","Object","assign","controller","_defaultPackage","defaultPackage","filters","type","modeDisplay","children","jsonString","JSON","parse","view","$","find","empty","length","items","parent","console","log","i","startNo","start","undefined","Number","endNo","end","j","item","addItem","params","index","itemParent","toLowerCase","err","packagePath","idComp","idArr","split","pop","join","editor","initParams","asset","jx","tools","cloneObject","gabaritID","id","replaceCharByNumber","src","db","classDefined","itemClass","getClass","data","onchanged","add","onChangeData","evt","warn","shortcut","getBoolDependsGroup","visible","append","push","addItems"],"mappings":"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","file":"EditionItemGenerator.js","sourcesContent":["import Component from \"jx/core/comps/Component\";\nself.texts = {\n    variante: \"Décrire ici les modifications souhaitées par rapport au modèle actuel.\"\n};\nlet viewsModels = {\n    tab: `\r\n<div class=\"container\">\r\n    <div class=\"row\">\r\n        <!-- MENU -->\r\n        <div class=\"col-xs-3\" id=\"myScrollspy\">\r\n            <ul id=\"mapList\" class=\"nav nav-pills nav-stacked\"></ul>\r\n        </div>\r\n        <!-- MENU END -->\r\n\r\n        <div class=\"col-xs-9\">\r\n            <div id=\"map\" class=\"tab-content content1\"></div>\r\n        </div>\r\n    </div>\r\n\r\n     <div id=\"gabaritEditorBox\" style=\"display:none;\">\r\n          <div class=\"row\" style=\"width:100%; background-color:#ADCCFF\">\r\n           <div class=\"col-xs-12\" style=\"width:100%\">\r\n               <input id=\"search\" type=\"search\"></input>\r\n               <div class=\"btn-group\" role=\"group\" aria-label=\"...\">\r\n                 <button type=\"button\" id=\"searchPrevious\" class=\"btn btn-default\" title=\"Next\"><span class=\"fa fa-arrow-left\"></span></button>\r\n                 <button type=\"button\" id=\"searchNext\" class=\"btn btn-default\"  title=\"Previous\"><span class=\"fa fa-arrow-right\"></span></button>\r\n                <button type=\"button\" id=\"addItem\" class=\"btn btn-default\"  title=\"add\"><span class=\"fa fa-plus-square-o\"></span></button>\r\n                </div>\r\n\r\n           </div>           \r\n           \r\n         </div>    \r\n         <div class=\"row\" style=\"height:93%;width:100%\">\r\n           <div class=\"col-xs-12\" style=\"height:100%;width:100%\">\r\n               <div id=\"gabaritEditor\" style=\"height:100%;width:100%\"></div>\r\n           </div>           \r\n           \r\n         </div>    \r\n     </div>\r\n           \r\n </div>\r\n`,\n    flat: `\r\n<div class=\"container\">\r\n    <div class=\"row\">\r\n        <!-- MENU -->\r\n        <div class=\"col-xs-1\" id=\"myScrollspy\">\r\n            <ul id=\"mapList\" class=\"nav nav-pills nav-stacked\"></ul>\r\n        </div>\r\n        <!-- MENU END -->\r\n\r\n        <div class=\"col-xs-11\">\r\n            <div id=\"map\"></div>\r\n        </div>\r\n    </div>\r\n\r\n     <div id=\"gabaritEditorBox\" style=\"display:none;\">\r\n          <div class=\"row\">\r\n           <div class=\"col-xs-12\">\r\n               <div id=\"gabaritEditor\" height=\"100%\"></div>\r\n           </div>           \r\n           \r\n         </div>    \r\n     </div>\r\n           \r\n </div>\r\n`\n};\nlet ItemShorcutsNames = {\n    \"Number\": \"NumberItem\",\n    \"Sound\": \"SoundItem\",\n    \"Image\": \"ImageItem\",\n    \"Boolean\": \"BooleanItem\",\n    \"Flashtml\": \"FlashtmlItem\",\n    \"FlashtmlPack\": \"FlashtmlPackItem\",\n    \"ImageSequence\": \"ImageSequenceItem\",\n    \"Video\": \"VideoItem\",\n    \"FLA\": \"FLAItem\",\n    \"class\": \"ClassFile\",\n};\nexport default class EditionItemGenerator extends Component {\n    constructor(dataObject) {\n        super(Object.assign({ controller: null }, dataObject));\n        this.controller = this.dataObject.controller; //Edition.js\n        this._defaultPackage = \"editionitems\";\n        this.defaultPackage = \"editionitems\";\n        this.filters = { type: \"all\" };\n        this.modeDisplay = \"tab\";\n        this.children = [];\n    }\n    setFilters(jsonString) {\n        if (jsonString == \"all\") {\n            this.filters = { type: \"all\" };\n            return;\n        }\n        this.filters = JSON.parse(jsonString);\n    }\n    get view() {\n        return viewsModels[this.modeDisplay];\n    }\n    clearView(view) {\n        $(view).find(\"#mapList\").empty();\n        $(view).find(\"#map\").empty();\n        this.children.length = 0;\n    }\n    addItems(items, parent) {\n        console.log(\"addItems\", items);\n        for (var i = 0; i < items.length; i++) {\n            console.log(\"addItem\", items[i]);\n            var startNo = items[i].start == undefined ? 0 : Number(items[i].start);\n            var endNo = items[i].end == undefined ? 0 : Number(items[i].end);\n            for (var j = startNo; j <= endNo; j++) {\n                var item = this.addItem(items[i], parent, j);\n            }\n            //items[i] = items[i], parent;\n        }\n        ;\n        console.log(\"addItems2\", items);\n    }\n    addItem(params, parent, index, itemParent) {\n        // create and init item\n        try {\n            if (params.type != \"Group\" && this.filters.type != \"all\" && this.filters.type != params.type.toLowerCase())\n                return params;\n        }\n        catch (err) {\n            console.log(err);\n        }\n        var packagePath = null;\n        var idComp = null;\n        var idArr = params.type.split(\".\");\n        if (idArr.length > 1) {\n            idComp = idArr[idArr.length - 1];\n            idArr.pop();\n            packagePath = idArr.join(\"/\");\n        }\n        else {\n            idComp = idArr[0];\n        }\n        if (!packagePath) {\n            var packagePath = (params.editor != undefined && params.editor.type != undefined) ? params.editor.type : this.defaultPackage;\n        }\n        // console.log(\"packagePath\", packagePath, params)\n        // console.log(\"jx/editor/\"+packagePath+\"/\"+idComp)\n        idComp = ItemShorcutsNames[idComp] || idComp; // converts if shortcut id\n        var initParams;\n        // iteration for files\n        if (params.asset && params.type != \"ImageSequence\") {\n            initParams = this.jx.tools.cloneObject(params); // need to clone and detach params here. no problem for files because items files need not to change gabarit, only link to src is needed for preview, downlod and drag drop.\n            initParams.gabaritID = params.id;\n            initParams.id = this.jx.tools.replaceCharByNumber(initParams.id, index);\n            initParams.asset = this.jx.tools.cloneObject(initParams.asset);\n            initParams.asset.src = this.jx.tools.replaceCharByNumber(initParams.asset.src, index);\n        }\n        else {\n            initParams = params; // else initparams given to item constructor is params object of original gabarit itself (kind of binding).\n        }\n        if (this.jx.db.classDefined(\"jx/editor/\" + packagePath + \"/\" + idComp)) {\n            var itemClass = this.jx.db.getClass(\"jx/editor/\" + packagePath + \"/\" + idComp);\n            var item = new itemClass({ jx: this.jx, data: initParams, controller: this.controller });\n            item.onchanged.add(evt => this.controller.onChangeData(evt));\n        }\n        else if (this.jx.db.classDefined(\"jx/editor/\" + this._defaultPackage + \"/\" + idComp)) {\n            var itemClass = this.jx.db.getClass(\"jx/editor/\" + this._defaultPackage + \"/\" + idComp);\n            var item = new itemClass({ jx: this.jx, data: initParams, controller: this.controller });\n            item.onchanged.add(evt => this.controller.onChangeData(evt));\n        }\n        else {\n            console.warn(\"EditionItemGenerator._addItem_\" + idComp + \" not exists\");\n            var itemClass = this.jx.db.getClass(\"jx/editor/\" + this._defaultPackage + \"/Todo\");\n            var item = new itemClass({ jx: this.jx, data: initParams, controller: this.controller });\n            item.onchanged.add(evt => this.controller.onChangeData(evt));\n        }\n        // if shortcut, we stop this addItem and call new one with initParams args\n        if (item.view.shortcut == true) {\n            delete item.view.shortcut;\n            return this.addItem(item.view, parent, index, itemParent);\n        }\n        ;\n        item.itemParent = itemParent;\n        // add it to content page\n        if (this.jx.editor.getBoolDependsGroup(initParams.visible, true)) {\n            if (parent == undefined) {\n                //console.log(item)\n                if (this.modeDisplay == \"flat\") {\n                    $(\"#map\").append(`<hr>`);\n                    $(\"#map\").append(`<div id=\"${item.id}Tab\" class=\"text-info\"><h5>${item.id}</h5></div>`);\n                    $(\"#map\").append(item.view);\n                }\n                else {\n                    //console.log(\"GROUP\",item.id, item.view.id,  item)\n                    $(\"#mapList\").append(`<li id=\"${item.id}Tab\"><a href=\"#${item.id}\"    data-toggle=\"tab\">${item.id}</a></li>`);\n                    $(\"#map\").append(item.view);\n                }\n            }\n            else {\n                //$(\"#mapList\").append(`<li><a href=\"#${item.id}\"  data-toggle=\"tab\">${item.id}</a></li>`);\n                $(parent).append(item.view);\n            }\n        }\n        this.children.push(item);\n        if (initParams.children != undefined) {\n            this.addItems(initParams.children, item.view, item);\n        }\n        ;\n        return initParams;\n    }\n}\n"]}