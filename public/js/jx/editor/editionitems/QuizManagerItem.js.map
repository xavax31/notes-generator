{"version":3,"sources":["../../../../src/jx/editor/editionitems/QuizManagerItem.js"],"names":["QuizManagerItem","dataObject","controller","data","exportType","childrenContainer","view","find","btnConfig","cc","type","id","title","confirmBeforeLaunch","onclick","configure","addNewQuizBTN","addNewQuiz","prepend","children","length","src","mess","editionPage","mainController","gabaritView","console","log","value","content","$","popup","validate","name","html","css","modal","_addNewQuiz","jx","editor","width","on","code","evt","keyCode","which","Date","now","gabarit","push","availableTypes","save","refreshEditionView","tab","findComp","result","i","search","formEl","options","opt","el","document","createElement","textContent","desc","attr","append","lock"],"mappings":"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","file":"QuizManagerItem.js","sourcesContent":["import DataGroup from \"jx/editor/editionitems/DataGroup\";\nexport default class QuizManagerItem extends DataGroup {\n    constructor(dataObject) {\n        super(dataObject);\n        this.controller = this.dataObject.controller;\n        this.data.exportType = \"DataGroup\";\n        //this.view.append($(\"<div><div id='children'></div></div>\"));\n        this.childrenContainer = this.view.find(\"#children\");\n        let btnConfig = this.cc({ type: \"editionitems.ButtonItem\", data: { id: \"btnConfig\", title: \"Configurer\", confirmBeforeLaunch: false, onclick: () => this.configure() } });\n        this.addNewQuizBTN = this.cc({ type: \"editionitems.ButtonItem\", data: { id: \"addNewQuizBTN\", title: \"Ajouter un nouveau quiz\", confirmBeforeLaunch: false, onclick: () => this.addNewQuiz() } });\n        this.childrenContainer.prepend(this.addNewQuizBTN.view);\n        this.data.children = this.data.children || [];\n        if (this.data.children.length === 0) {\n            this.data.children = [\n                {\n                    type: \"Separator\"\n                },\n                {\n                    id: \"defaultImage\",\n                    \"type\": \"Image\",\n                    title: \"Image de placement\",\n                    \"description\": \"Est utilisée à la place de toute image manquante (questions ou réponse)\",\n                    \"asset\": {\n                        src: \"images/QUIZ_DEFAULT_IMAGE.png\"\n                    }\n                }\n            ];\n        }\n        ;\n        this.children = [];\n    }\n    showInfo() { }\n    hideInfo() { }\n    addNewQuiz({ mess } = {}) {\n        let editionPage = this.controller.mainController;\n        let gabaritView = editionPage.gabaritView;\n        console.log(gabaritView.value);\n        let content = `\n        <div id=\"mess\" class=\"alert alert-danger\" style=\"display:none;margin-bottom:10px\"></div>\n        <div class=\"form-horizontal\">\n            <div class=\"form-group\">    \n                <label class=\"control-label col-sm-2\" for=\"quizName\">Nom du quiz</label>\n                <div class=\"col-sm-10\">\n                <input  id=\"quizName\" type=\"text\"  class=\"form-control\"  placeholder=\"Nouveau Quiz\" value=\"\"/>\n                </div>\n            </div>\n           <div class=\"form-group\">    \n                <div class=\"col-sm-12 text-right\">\n                    <button  id=\"create\" type=\"button\" class=\"btn btn-default\">Créer le Quiz</button>\n                    <button  id=\"cancel\" type=\"button\"  class=\"btn btn-default\">Fermer</button>\n                </div>\n                    \n            </div>\n         </div>\n            `;\n        var find = (id) => {\n            return $(popup).find(\"#\" + id)[0];\n        };\n        let validate = () => {\n            let name = find(\"quizName\").value;\n            if (name == \"\") {\n                $(popup).find(\"#mess\").html(\"Veuillez svp saisir un nom pour votre quiz\");\n                $(popup).find(\"#mess\").css(\"display\", \"block\");\n            }\n            else {\n                popup.modal('hide');\n                this._addNewQuiz({\n                    name: find(\"quizName\").value\n                });\n            }\n        };\n        let popup = this.jx.editor.popup({ title: \"Ajouter un nouveau quiz\", content, width: 600 });\n        if (mess) {\n            $(popup).find(\"#mess\").html(mess);\n            $(popup).find(\"#mess\").css(\"display\", \"inline\");\n        }\n        ;\n        $(popup).find(\"#create\").on(\"click\", () => validate());\n        $(popup).find(\"#cancel\").on(\"click\", () => {\n            popup.modal('hide');\n        });\n        $(popup).find(\"#quizName\").on('keypress', evt => {\n            var code = evt.keyCode || evt.which;\n            if (code == 13) {\n                validate();\n            }\n        });\n    }\n    _addNewQuiz({ name }) {\n        let editionPage = this.controller.mainController;\n        let gabaritView = editionPage.gabaritView;\n        let id = \"QuizData_\" + Date.now();\n        gabaritView.gabarit.push({\n            id: id,\n            title: name,\n            type: \"QuizData\",\n            availableTypes: this.data.availableTypes || \"*\",\n            children: []\n        });\n        editionPage.save(() => {\n            editionPage.refreshEditionView();\n            console.log(gabaritView);\n            $('.nav-tabs a[href=\"#' + id + '\"]').tab('show');\n            gabaritView.findComp({ id: id }).configure();\n        });\n    }\n    _getQuizDatas() {\n        let editionPage = this.controller.mainController;\n        let gabaritView = editionPage.gabaritView;\n        let result = [];\n        for (var i = 0; i < this.gabaritView.gabarit.length; i++) {\n            if (this.gabaritView.gabarit[i].id.search(/^QuizData_/) !== -1) {\n                result.push(this.gabaritView.gabarit[i]);\n            }\n        }\n        ;\n        return result;\n    }\n    _fillComboBox({ formEl, options }) {\n        for (var i = 0; i < options.length; i++) {\n            var opt = options[i];\n            var el = document.createElement(\"option\");\n            el.textContent = opt.desc;\n            el.value = opt.id;\n            $(el).attr(\"selected\", (opt.id == options[0].value));\n            formEl.append(el);\n        }\n    }\n    set lock(value) {\n        if (this.addNewQuizBTN)\n            this.addNewQuizBTN.lock = value;\n    }\n}\n"]}