{"version":3,"sources":["../../../../src/jx/editor/editionitems/CatalogTestItem.js"],"names":["access","project","preview","edit","view","debug","delete","moveToArchives","exportProject","model","appengine","archive","component","doc","CatalogTestItem","dataObject","console","log","controller","data","Object","assign","id","title","url","status","description","trim","statusStyle","order","todo","test","doing","open","done","close","statusStyleCSS","iconStyle","search","replace","_template","toUpperCase","item","$","prop","me","find","each","index","css","_hasAccess","click","action","event","currentTarget","jx","editor","editProject","type","getDirectoryURL","win","window","previewIndex","info","changeLocation","link","projectURL","createNewProjectDialog","modelData","refreshList","newProjectData","popup","content","buttons","ok","label","no","onclose","evt","popup2","alert","closable","moveProject","targetID","modal","deleteProjectDial","idFunctionnality","userIsGroup","toLowerCase","split","appData","sendToTest"],"mappings":"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","file":"CatalogTestItem.js","sourcesContent":["import VisualComponent from \"jx/core/comps/VisualComponent\";\nlet access = {\n    project: {\n        preview: \"*\",\n        edit: \"*\",\n        view: \"*\",\n        debug: \"*\",\n        \"new\": \"admin,manager,dev\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"admin,manager,dev\",\n        exportProject: \"\" // TODO: exportProject can not be put on home page anymore (will need instanciation of light version of ApplicationBabelHTML5 class).  This is accessible in edition page only.\n    },\n    model: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"*\",\n        delete: \"admin,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    appengine: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"*\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    archive: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"admin,manager,dev\",\n        delete: \"admin,manager,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    component: {\n        preview: \"*\",\n        edit: \"admin,dev\",\n        view: \"*\",\n        \"new\": \"admin,dev\",\n        delete: \"admin,dev\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    },\n    doc: {\n        preview: \"*\",\n        edit: \"\",\n        view: \"\",\n        \"new\": \"\",\n        delete: \"\",\n        moveToArchives: \"\",\n        exportProject: \"\"\n    }\n};\nexport default class CatalogTestItem extends VisualComponent {\n    constructor(dataObject) {\n        super(dataObject);\n        console.log(\"CatalogItem2 constr\", dataObject, this.dataObject);\n        this.controller = this.dataObject.controller;\n        this.data = Object.assign({\n            id: null,\n            title: null,\n            url: null,\n            status: \"all\",\n            description: \"\"\n        }, this.data);\n        var title = this.data.id;\n        if (this.data.title && this.data.title.trim() != \"\") {\n            title = `${this.data.id} (${this.data.title})`;\n        }\n        let statusStyle = {\n            \"new\": \"css->background-color: #ffff00; color: #000000\", order: \"danger\", todo: \"danger\", \"dev-tovalidate\": \"danger\", \"dev-confirmed\": \"success\", \"R&D\": \"warning\", test: \"info\", debug: \"warning\",\n            doing: \"warning\", open: \"warning\", done: 'success', close: 'success'\n        }[this.data.status] || \"info\";\n        let statusStyleCSS = \"\";\n        let iconStyle = {\n            \"new\": \"fa-star\", order: \"fa-list-alt\", todo: \"fa-exclamation-triangle\", test: \"fa-flask\", \"R&D\": \"fa-flask\",\n            debug: \"fa-bug\", open: \"fa-cogs\", doing: \"fa-cogs\", done: 'fa-check-circle',\n            close: 'fa-check-circle'\n        }[this.data.status];\n        if (statusStyle.search(/^css->/) != -1) {\n            statusStyleCSS = statusStyle.replace(/^css->/, \"\");\n            statusStyle = \"info\";\n        }\n        let _template = `\n            <div class=\"panel panel-info paddingItem\">\n                <div class=\"row \">\n                    <div class=\"col-sm-4\">\n                        <h3 class=\"panel-title \">${title}</h3>\n                        <span class=\"label label-${statusStyle}\" style=\"${statusStyleCSS}\">\n                            <span class=\"fa ${iconStyle}\">\n                                <span class=\"catalogItemStatus\">${this.data.status.toUpperCase()}</span>\n                            </span>\n                        </span>\n                    </div>\n                    <div class=\"col-sm-4\" id=\"buttons\">\n                        <button id=\"preview\" class=\"btn btn-default\" title=\"Voir\"><span class=\"fa fa-eye\"></span></button>\n                        <button id=\"debug\" class=\"btn btn-default\" title=\"Debug\"><span class=\"fa fa-bug\"></span></button>\n                     </div>\n                    <div class=\"col-sm-4\">\n                    </div>\n                </div>\n                <div class=\"row \">\n                    <div class=\"col-sm-12\">\n                    </div>\n                </div>\n            </div>\n        `;\n        var item = $(_template);\n        item.prop('id', this.data.id);\n        var me = this;\n        item.find(\"button\").each(function (index) {\n            console.log($(this).prop('id'));\n            $(this).css(\"display\", (me._hasAccess($(this).prop('id')) ? \"inline\" : \"none\"));\n        });\n        item.find(\"button\").data(this.data);\n        item.find(\"button\").click(event => {\n            var action = $(event.currentTarget).prop('id');\n            var data = $(event.currentTarget).data();\n            console.log(action, data);\n            switch (action) {\n                case \"edit\":\n                    this.jx.editor.editProject({\n                        id: data.id,\n                        url: data.url\n                    });\n                    break;\n                case \"preview\":\n                    if (data.type == \"Doc\") {\n                        let url = (data.url.search(/^http/) == -1) ? this.jx.editor.getDirectoryURL(\"docsURL\") + \"/\" + data.url : data.url;\n                        let win = window.open(url);\n                    }\n                    else {\n                        let url = data.url + \"/public\";\n                        url = (this.data.previewIndex != \"\") ? url + \"/\" + data.previewIndex : url;\n                        // this.jx.tools.openURL(url, data.id);\n                        url = \"http://xb:CSLDJV37@192.168.0.80:3000\" + url;\n                        if (url.search(/\\?/) != -1) {\n                            url = url.replace(\"\\?\", \"?context=cordova&\");\n                        }\n                        else {\n                            url = url + \"?context=cordova\";\n                        }\n                        console.info(url);\n                        this.controller.changeLocation({ link: url });\n                    }\n                    break;\n                case \"debug\":\n                    let url = data.url + \"/public/index_dev.html?debug=true&jxsrc=true\";\n                    //url = (this.data.previewIndex != \"\") ? url + \"/\" + data.previewIndex : url;\n                    // this.jx.tools.openURL(url, data.id);\n                    url = \"http://xb:CSLDJV37@192.168.0.80:3000\" + url;\n                    if (url.search(/\\?/) != -1) {\n                        url = url.replace(\"\\?\", \"?context=cordova&\");\n                    }\n                    else {\n                        url = url + \"?context=cordova\";\n                    }\n                    console.info(url);\n                    this.controller.changeLocation({ link: url });\n                    break;\n                case \"exportProject\":\n                    this.jx.editor.exportProject({\n                        id: data.id,\n                        projectURL: data.url\n                    });\n                    break;\n                case \"new\":\n                    this.jx.editor.createNewProjectDialog({ modelData: data }, newProjectData => {\n                        this.controller.refreshList();\n                        this.jx.editor.editProject({\n                            id: newProjectData.id,\n                            url: newProjectData.url\n                        });\n                    });\n                    break;\n                case \"moveToArchives\":\n                    this.jx.editor.popup({ title: \"Comfirmation de l'envoi en Archives\",\n                        content: \"Attention, cette action va fermer et archiver ce projet.\\n Etes-vous sûr ?\",\n                        buttons: {\n                            ok: { label: \"Oui\" },\n                            no: { label: \"Non\" }\n                        },\n                        onclose: evt => {\n                            if (evt.action == \"ok\") {\n                                var popup2 = this.jx.editor.alert({ title: \"Opération en cours\", content: \"Veuillez patienter svp...\", closable: false });\n                                this.jx.editor.moveProject({\n                                    url: data.url,\n                                    targetID: \"archives\"\n                                }, evt => {\n                                    this.controller.refreshList();\n                                    popup2.modal('hide');\n                                });\n                            }\n                        }\n                    });\n                    break;\n                case \"delete\":\n                    this.jx.editor.deleteProjectDial({ id: data.id, url: data.url }, evt => {\n                        this.controller.refreshList();\n                    });\n                    break;\n            }\n        });\n        this.view = item;\n    }\n    _hasAccess(idFunctionnality) {\n        console.log(\"_hasAccess\", idFunctionnality, this.data.type);\n        return this.jx.editor.userIsGroup(...access[this.data.type.toLowerCase()][idFunctionnality].split(\",\"));\n    }\n    /** Export project */\n    _moveToArchivesDial(appData) {\n        this.jx.editor.popup({ title: \"Comfirmation de l'envoi en Archives\",\n            content: \"Attention, cette action va fermer et archiver ce projet.\\n Etes-vous sûr ?\",\n            buttons: {\n                ok: { label: \"Oui\" },\n                no: { label: \"Non\" }\n            },\n            onclose: evt => {\n                if (evt.action == \"ok\") {\n                    var popup2 = this.jx.editor.alert({ title: \"Opération en cours\", content: \"Veuillez patienter svp...\", closable: false });\n                    this.sendToTest(null, evt => {\n                        popup2.modal('hide');\n                    });\n                }\n            }\n        });\n    }\n}\n"]}