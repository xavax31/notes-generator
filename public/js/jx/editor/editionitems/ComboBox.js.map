{"version":3,"sources":["../../../../src/jx/editor/editionitems/ComboBox.js"],"names":["ComboBox","dataObject","content","$","view","find","html","data","options","jx","editor","getOptionsList","realValue","value","undefined","id","valueExistsInOptions","i","length","opt","el","document","createElement","textContent","split","attr","desc","append","console","log","css","prop","editable","on","event","currentTarget","onchanged","dispatch","target","defaulValue","empty"],"mappings":"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","file":"ComboBox.js","sourcesContent":["import BasicItem from \"jx/editor/editionitems/BasicItem\";\nexport default class ComboBox extends BasicItem {\n    constructor(dataObject) {\n        super(dataObject);\n        //console.log(dataObject, this.dataObject)\n        this.content = $(`<select class=\"form-control\" id=\"value\">`);\n        this.view.find(\"#content\").html(this.content);\n        if (typeof this.data.options == \"string\") {\n            var options = this.jx.editor.getOptionsList(this.data.options);\n        }\n        else {\n            var options = this.data.options;\n        }\n        let realValue;\n        if (this.data.value == undefined || this.data.value == \"\") {\n            var value = (typeof options[0] == \"string\") ? options[0] : options[0].id;\n        }\n        else {\n            var value = this.data.value;\n        }\n        let valueExistsInOptions = false;\n        for (var i = 0; i < options.length; i++) {\n            var opt = options[i];\n            var el = document.createElement(\"option\");\n            if (typeof opt == \"string\") {\n                el.textContent = opt;\n                el.value = opt;\n                if (opt.split(\":\")[0] == value.split(\":\")[0]) {\n                    $(el).attr(\"selected\", true);\n                    valueExistsInOptions = true;\n                    realValue = opt.split(\":\")[0];\n                }\n            }\n            else {\n                el.textContent = opt.desc || opt.id;\n                el.value = opt.id;\n                if (opt.id == value.split(\":\")[0]) {\n                    $(el).attr(\"selected\", true);\n                    valueExistsInOptions = true;\n                    realValue = opt.desc;\n                }\n            }\n            this.view.find(\"#value\").append(el);\n        }\n        console.log(\"VALUE\", value, valueExistsInOptions, options);\n        if (!valueExistsInOptions) {\n            this.view.find(\"#informationsText\").html(`\n/!\\\\ La valeur ${realValue} définie pour ce champ n'est pas ou plus disponible dans les choix possibles. \n<br/>\nLes raisons peuvent être:\n<br/>\n- une mauvaise configuration de la liste. Voir le développeur pour corriger.\n<br/>\n- La valeur a été supprimée volontairement de la liste. Par exemple, une typo qui a été supprimée de la liste globale des fontes. Voir le responsable de ces listes pour plus d'infos.\n<br/>\n<br/>\nBien que cette valeur n'apparaisse pas dans ce champ, étant remplacée par le choix suivant dans la liste, c'est bien cette valeur manquante qui est utlisée dans le jeu, pouvant donc entrainer un comportement imprévu, voir un plantage.\n<br/>\n`);\n            // setTimeout(()=>this.showInfo(), 3000);\n            this.view.find(\"#info\").html('<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>');\n            this.view.find(\"#info\").css({ \"color\": \"white\", \"backgroundColor\": \"orange\" });\n        }\n        this.view.find(\"#value\").prop('disabled', !this.editable);\n        this.view.on(\"change\", (event) => {\n            this.data.value = $(event.currentTarget).data(\"controller\").value.split(\":\")[0];\n            this.onchanged.dispatch({ currentTarget: this, target: this });\n        });\n    }\n    _refreshData() {\n        this.data.value = this.value;\n    }\n    _refreshView() {\n        this.data.value = this.value;\n    }\n    get value() {\n        return this.view.find(\"#value\")[0].value;\n    }\n    setOptions(options, defaulValue) {\n        console.log(options);\n        this.view.find(\"#value\").empty();\n        if (typeof options == \"string\") {\n            options = this.jx.editor.getOptionsList(options);\n        }\n        if (defaulValue == undefined || defaulValue == \"\") {\n            var value = (typeof options[0] == \"string\") ? options[0] : options[0].id;\n        }\n        else {\n            var value = defaulValue;\n        }\n        console.log(value);\n        for (var i = 0; i < options.length; i++) {\n            var opt = options[i];\n            var el = document.createElement(\"option\");\n            if (typeof opt == \"string\") {\n                el.textContent = opt;\n                el.value = opt;\n                $(el).attr(\"selected\", (opt.split(\":\")[0] == value.split(\":\")[0]));\n            }\n            else {\n                el.textContent = opt.desc || opt.id;\n                el.value = opt.id;\n                $(el).attr(\"selected\", opt.id == value.split(\":\")[0]);\n            }\n            this.view.find(\"#value\").append(el);\n        }\n        this.data.value = value;\n    }\n    set lock(value) {\n        if (!value) {\n            this.view.find(\"#value\").prop('disabled', !this.editable);\n        }\n        else {\n            this.view.find(\"#value\").prop('disabled', true);\n        }\n    }\n}\n"]}