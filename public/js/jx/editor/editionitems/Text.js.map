{"version":3,"sources":["../../../../src/jx/editor/editionitems/Text.js"],"names":["Text","dataObject","Object","assign","icoTitle","icoSymbol","actions","informations","backgroundColor","content","$","view","find","append","html","data","value","replace","RegExp","prop","css","_refreshDate","lock","editable","on","event","autoRefresh","_refreshData","onchanged","dispatch","target","_opened","_refreshTextField","d","Date","Number","timestamp","daysFrench","dateStr","getDay","getDate","jx","tools","gd","getMonth","getFullYear","getHours","getMinutes","getSeconds","_oldH","height","undefined","text"],"mappings":"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","file":"Text.js","sourcesContent":["import BasicItem from \"jx/editor/editionitems/BasicItem\";\nexport default class Text extends BasicItem {\n    constructor(dataObject) {\n        super(Object.assign({\n            icoTitle: \"Voir\",\n            icoSymbol: \"font\",\n            actions: [],\n            informations: [],\n            backgroundColor: \"#F9F9F9\"\n        }, dataObject));\n        //console.log(dataObject, this.dataObject)\n        this.content = $(`<textarea id=\"value\" type=\"textarea\" style=\"resize:vertical\"  spellcheck=\"true\"  rows=\"1\" class=\"form-control\"></textarea><div  class=\"form-control\" id=\"valueRead\" style=\"maxHeight:200px;overflow:auto\"></div>\n            `);\n        this.view.find(\"#content\").append(this.content);\n        this.view.find(\"#value\").html(this.data.value || \"\");\n        this.view.find(\"#valueRead\").html(this.value.replace(new RegExp(\"\\n\", \"g\"), \"<br>\"));\n        this.view.find(\"#valueRead\").prop(\"disabled\", true);\n        this.view.find(\"#valueRead\").css(\"backgroundColor\", \"#eeeeee\");\n        this.view.find(\"#description\").append('<div id=\"updatetime\" style=\"display:none\"></div>');\n        this._refreshDate();\n        this.lock = !this.editable;\n        this.view.find(\"#value\").on(\"change\", (event) => {\n            //this.data.timestamp = Date.now();\n            this._refreshDate();\n            if (this.autoRefresh)\n                this._refreshData();\n            this.view.find(\"#valueRead\").html(this.value.replace(new RegExp(\"\\n\", \"g\"), \"<br>\"));\n            this.onchanged.dispatch({ target: this });\n        });\n        this._opened = false;\n        this.view.find(\"#valueRead\").on(\"dblclick\", (event) => {\n            this._opened = !this._opened;\n            this._refreshTextField();\n        });\n        this.view.find(\"#value\").on(\"dblclick\", (event) => {\n            this._opened = !this._opened;\n            this._refreshTextField();\n        });\n        this._refreshTextField();\n    }\n    _refreshDate() {\n        var d = new Date(Number(this.data.timestamp));\n        //alert (this.data.id + \",\" + this.data.timestamp+ \",\" + d)\n        // alert(d)\n        var daysFrench = [\"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\", \"Dimanche\"];\n        var dateStr = daysFrench[d.getDay()] + \" \" + d.getDate() + \"/\" + this.jx.tools.gd(d.getMonth() + 1, 2) + \"/\" + d.getFullYear() + \"  \" + (d.getHours()) + \":\" + this.jx.tools.gd(d.getMinutes(), 2) + \":\" + this.jx.tools.gd(d.getSeconds(), 2);\n        this.view.find(\"#updatetime\").html(d);\n    }\n    _refreshTextField() {\n        if (this._opened) {\n            this._oldH = this.view.find(\"#valueRead\").height();\n            this.view.find(\"#valueRead\").css(\"height\", \"auto\");\n            this.view.find(\"#value\").height(this.view.find(\"#value\").prop(\"scrollHeight\"));\n        }\n        else {\n            if (this._oldH != undefined) {\n                this.view.find(\"#valueRead\").height(this._oldH);\n                this.view.find(\"#value\").height(this._oldH);\n            }\n            ;\n        }\n    }\n    _refreshData() {\n        this.data.value = this.value;\n    }\n    _refreshView() {\n        this.data.value = this.value;\n    }\n    get value() {\n        return this.view.find(\"#value\")[0].value;\n    }\n    set value(text = \"\") {\n        this.view.find(\"#valueRead\").html(text.replace(new RegExp(\"\\n\", \"g\"), \"<br>\"));\n        this.view.find(\"#value\").html(text);\n        this._refreshData();\n    }\n    set textFold(value) {\n        if (this._opened === !value)\n            return;\n        this._opened = !value;\n        this._refreshTextField();\n    }\n    set lock(value) {\n        if (!value) {\n            if (this.editable) {\n                this.view.find(\"#value\").prop('readonly', false);\n                this.view.find(\"#value\").css(\"display\", \"block\");\n                this.view.find(\"#valueRead\").css(\"display\", \"none\");\n            }\n            else {\n                this.view.find(\"#value\").prop('readonly', true);\n                this.view.find(\"#value\").css(\"display\", \"none\");\n                this.view.find(\"#valueRead\").css(\"display\", \"block\");\n            }\n        }\n        else {\n            this.view.find(\"#value\").prop('readonly', true);\n            this.view.find(\"#value\").css(\"display\", \"none\");\n            this.view.find(\"#valueRead\").css(\"display\", \"block\");\n        }\n    }\n}\n"]}