{"version":3,"sources":["../../../../src/jx/projecttypes/editorformattype2/Importer.js"],"names":["Importer","jx","dataObject","Object","assign","url","projectJXData","projectData","configPath","onFinished","_loadJson","db","addResources","id","type","src","load","jsonResource","findOne","data","debug","warn","editor","popup","title","content","gabaritJSON","_jsonAnalyse","reload","projectDataJSON","i","length","projectInfosChildren","children","projectInfos","value","projectInformations","project","moduleData","gabarit","modules","push","_finish","_destroy"],"mappings":"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","file":"Importer.js","sourcesContent":["import JXObject from \"jx/core/JXObject\";\nimport ProjectData from \"jx/core/dataobjects/ProjectData\";\nimport ModuleData from \"jx/core/dataobjects/ModuleData\";\nexport default class Importer extends JXObject {\n    constructor(jx, dataObject) {\n        super({ jx });\n        this.dataObject =\n            Object.assign({\n                url: null,\n                projectJXData: null\n            }, dataObject);\n        this.projectData = new ProjectData();\n        this.projectData.url = this.dataObject.url;\n        this.projectData.configPath = this.dataObject.configPath || (this.dataObject.url + \"/etc/editor/editor.json\");\n    }\n    importConfig(onFinished) {\n        this.onFinished = onFinished;\n        this._loadJson();\n    }\n    _loadJson() {\n        this.jx.db.addResources({ id: this.projectData.configPath, type: \"json\", src: this.projectData.configPath });\n        this.jx.db.load({ id: this.projectData.configPath }, evt => {\n            var jsonResource = this.jx.db.findOne({ id: this.projectData.configPath });\n            if (!jsonResource || !jsonResource.data) {\n                this.jx.debug.warn(\"editor.json doesn't exist or is broken\");\n                this.jx.editor.popup({ title: \"Error\", content: \"editor.json doesn't exist or is broken\" });\n                return;\n            }\n            this.projectData.gabaritJSON = jsonResource.data;\n            this._jsonAnalyse();\n        }, {\n            reload: true\n        });\n    }\n    _jsonAnalyse() {\n        //-- get projectData array in json\n        var projectDataJSON = this.projectData.gabaritJSON[\"projectData\"];\n        //-- Extracts Informations json data and copy in new object this.projectData.projectInformations\n        for (var i = 0; i < projectDataJSON.length; i++) {\n            if (projectDataJSON[i].id == \"Informations\") {\n                var projectInfosChildren = projectDataJSON[i].children;\n                break;\n            }\n        }\n        ;\n        var projectInfos = {};\n        for (var i = 0; i < projectInfosChildren.length; i++) {\n            projectInfos[projectInfosChildren[i].id] = projectInfosChildren[i].value;\n        }\n        ;\n        this.projectData.projectInformations = projectInfos; // {project: {...}, engine: {...}}\n        //-- used?\n        this.projectData.projectInformations.project.configPath = this.projectData.configPath;\n        var moduleData = new ModuleData();\n        // moduleData.srcPath = projectInfos.engine.modulePath;\n        moduleData.gabarit = projectDataJSON;\n        // moduleData.moduleClass = null;\n        this.projectData.modules.length = 0;\n        this.projectData.modules.push(moduleData);\n        this._finish();\n    }\n    _finish() {\n        this._destroy();\n        this.onFinished(this.projectData);\n    }\n    _destroy() {\n        //this.jx.db.removeResources({id:'editorJSON'});\n    }\n}\n"]}