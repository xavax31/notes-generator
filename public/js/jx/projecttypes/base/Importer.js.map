{"version":3,"sources":["../../../../src/jx/projecttypes/base/Importer.js"],"names":["Importer","inputParams","projectData","url","onFinished","_loadJson","json","configURL","jsonUrl","jx","db","addResources","id","type","src","load","$","proxy","_jsonLoaded","Event","jsonResource","findOne","console","log","data","debug","fatal","moduleJSON","_getEntryPointPath","moduleData","srcPath","resources","_getResources","styles","_getStyles","gabarit","_getGabarit","modules","push","projectInformations","importClass","Module","moduleClass","_finish","_destroy","resourceInfos","resourceArray","i","length","resourceInfo","resource","modulejsonName"],"mappings":"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","file":"Importer.js","sourcesContent":["import JXObject from \"jx/core/JXObject\";\nimport Resource from \"jx/core/Resource\";\nimport ProjectData from \"jx/core/dataobjects/ProjectData\";\nimport ModuleData from \"jx/core/dataobjects/ModuleData\";\nclass Importer extends JXObject {\n    constructor(inputParams) {\n        super();\n        this.inputParams = inputParams;\n        this.projectData = new ProjectData();\n        this.projectData.url = this.inputParams.url;\n    }\n    importConfig(onFinished) {\n        this.onFinished = onFinished;\n        this._loadJson();\n    }\n    _loadJson() {\n        this.json = null;\n        this.configURL = this.projectData.url + \"/etc/editor/editor.json\";\n        this.jsonUrl = this.configURL;\n        this.jx.db.addResources({ id: 'configJSON', type: \"json\", src: this.jsonUrl });\n        this.jx.db.load({ id: 'configJSON' }, $.proxy(this._jsonLoaded, this));\n    }\n    _jsonLoaded(Event) {\n        //find json resource\n        var jsonResource = this.jx.db.findOne({ id: 'configJSON' });\n        console.log(\"loadJSON loaded\", jsonResource.data);\n        if (!jsonResource) {\n            console.log(this.jx.debug.fatal(\"No Data File\"));\n        }\n        this.json = jsonResource.data;\n        this.moduleJSON = this.json[\"entry-point\"][this._getEntryPointPath()];\n        var moduleData = new ModuleData();\n        moduleData.srcPath = this._getEntryPointPath();\n        moduleData.resources = this._getResources();\n        moduleData.styles = this._getStyles();\n        moduleData.gabarit = this._getGabarit();\n        this.projectData.modules.push(moduleData);\n        this.projectData.projectInformations = this.json[\"ProjectInformations\"];\n        //--- load module main class\n        this.jx.db.importClass([moduleData.srcPath + \"/index\"], (Module) => {\n            moduleData.moduleClass = Module;\n            this._finish();\n        });\n    }\n    _finish() {\n        this._destroy();\n        // if(this.projectData.check()){\n        this.onFinished(this.projectData);\n        // }\n        // else{\n        // \tconsole.warn(\"Cannot initialise application. Import data malformed\");\n        // }\n    }\n    _destroy() {\n        //this.jx.db.removeResources({id:'configJSON'});\n    }\n    _getResources() {\n        var resourceInfos = this.moduleJSON[\"resources\"];\n        var resourceArray = [];\n        for (var i = 0; i < resourceInfos.length; i++) {\n            var resourceInfo = resourceInfos[i];\n            var resource = new Resource(resourceInfo);\n            resourceArray.push(resource);\n        }\n        return resourceArray;\n    }\n    _getStyles() {\n        return this.moduleJSON[\"styles\"] || [];\n    }\n    _getGabarit() {\n        return this.moduleJSON[\"gabarit\"] || [];\n    }\n    _getEntryPointPath() {\n        for (var modulejsonName in this.json[\"entry-point\"]) {\n            return modulejsonName;\n            break;\n        }\n    }\n}\nexport default Importer;\n"]}