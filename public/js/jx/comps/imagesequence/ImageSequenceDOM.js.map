{"version":3,"sources":["../../../../src/jx/comps/imagesequence/ImageSequenceDOM.js"],"names":["ImageSequenceDOM","dataObject","_initialise","_createView","_firstInit","_ready","_framerateRatio","createjs","Ticker","framerate","_frame","play","view","resourceID","imageSequenceResource","jx","db","findOne","id","_bitmap_view","Image","src","data","$","css","width","naturalWidth","height","naturalHeight","params","ticker","addEventListener","_tick","bind","removeEventListener","bypass","length","bitmapData","mod","extendsFrom","mixin","ImageDOM"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QACqBA,gB;;;AACjB,kCAAYC,UAAZ,EAAwB;AAAA;;AAAA,4IACdA,UADc;;AAEpB,kBAAKC,WAAL;AAFoB;AAGvB;;;;0CAMa;AACV,qBAAKC,WAAL;AACA,qBAAKC,UAAL;AACA,qBAAKC,MAAL,GAAc,IAAd;AACA,qBAAKC,eAAL,GAAuBC,SAASC,MAAT,CAAgBC,SAAhB,GAA4B,EAAnD;AACA,qBAAKC,MAAL,GAAc,CAAd;AACA,qBAAKC,IAAL,CAAU,EAAV;AACH;;;0CACa;AACV,oBAAIC,IAAJ;AACA,oBAAI,KAAKX,UAAL,CAAgBY,UAAhB,IAA8B,IAAlC,EAAwC;AACpC,yBAAKC,qBAAL,GAA6B,KAAKC,EAAL,CAAQC,EAAR,CAAWC,OAAX,CAAmB,EAAEC,IAAI,KAAKjB,UAAL,CAAgBY,UAAtB,EAAnB,CAA7B;AACA,yBAAKM,YAAL,GAAoB,IAAIC,KAAJ,EAApB;AACA,yBAAKD,YAAL,CAAkBE,GAAlB,GAAwB,KAAKP,qBAAL,CAA2BQ,IAA3B,CAAgC,CAAhC,EAAmCD,GAA3D;AAGH;;AAED,qBAAKT,IAAL,GAAYW,EAAE,KAAKJ,YAAP,CAAZ;;AAGA,qBAAKP,IAAL,CAAUY,GAAV,CAAc,UAAd,EAA0B,UAA1B;AACA,qBAAKC,KAAL,GAAa,KAAKX,qBAAL,CAA2BQ,IAA3B,CAAgC,CAAhC,EAAmCA,IAAnC,CAAwCI,YAArD;AACA,qBAAKC,MAAL,GAAc,KAAKb,qBAAL,CAA2BQ,IAA3B,CAAgC,CAAhC,EAAmCA,IAAnC,CAAwCM,aAAtD;AACH;;;iCAIIC,M,EAAQ;AACT,qBAAKC,MAAL,GAAcvB,SAASC,MAAT,CAAgBuB,gBAAhB,CAAiC,MAAjC,EAAyC,KAAKC,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAzC,CAAd;AACH;;;mCACM;AACH1B,yBAASC,MAAT,CAAgB0B,mBAAhB,CAAoC,MAApC,EAA4C,KAAKJ,MAAjD;AACH;;;oCACO;AACJ,qBAAKK,MAAL,GAAe,KAAKA,MAAL,GAAc,CAAd,GAAkB,KAAK7B,eAAxB,GAA2C,KAAK6B,MAAL,GAAc,CAAzD,GAA6D,CAA3E;AACA,oBAAI,KAAKA,MAAL,IAAe,CAAnB,EAAsB;AAClB;AACH;AACD;;AAEA,qBAAKhB,YAAL,CAAkBE,GAAlB,GAAwB,KAAKP,qBAAL,CAA2BQ,IAA3B,CAAgC,KAAKZ,MAArC,EAA6CY,IAA7C,CAAkDD,GAA1E;AACA,oBAAI,KAAKX,MAAL,IAAe,KAAKI,qBAAL,CAA2BQ,IAA3B,CAAgCc,MAAhC,GAAyC,CAA5D,EAA+D;AAC3D,yBAAK1B,MAAL,GAAc,CAAd;AACH;AACD,qBAAKA,MAAL;AACH;;;8BArBc2B,U,EAAY;AACvB,qBAAKzB,IAAL,CAAUS,GAAV,GAAgBgB,UAAhB;AACH;;;0CAhCoBC,G,EAAK;AACtBA,oBAAIC,WAAJ,CAAgB,iBAAhB;AACAD,oBAAIE,KAAJ,CAAU,CAAC,aAAD,EAAgB,aAAhB,EAA+B,YAA/B,CAAV,EAAwDC,QAAxD,EAAkE,kBAAlE;AACAH,oBAAIpC,WAAJ;AACH;;;;;;sBATgBF,gB","file":"ImageSequenceDOM.js","sourcesContent":["import VisualComponentDOM from \"jx/comps/visualcomponent/VisualComponentDOM\";\nexport default class ImageSequenceDOM extends VisualComponentDOM {\n    constructor(dataObject) {\n        super(dataObject);\n        this._initialise();\n    }\n    static initialiseMod(mod) {\n        mod.extendsFrom(\"VisualComponent\");\n        mod.mixin([\"_initialise\", \"_createView\", \"bitmapData\"], ImageDOM, \"ImageSequenceDOM\");\n        mod._initialise();\n    }\n    _initialise() {\n        this._createView();\n        this._firstInit();\n        this._ready = true;\n        this._framerateRatio = createjs.Ticker.framerate / 12;\n        this._frame = 0;\n        this.play({});\n    }\n    _createView() {\n        var view;\n        if (this.dataObject.resourceID != null) {\n            this.imageSequenceResource = this.jx.db.findOne({ id: this.dataObject.resourceID });\n            this._bitmap_view = new Image();\n            this._bitmap_view.src = this.imageSequenceResource.data[0].src;\n            // view = new Image();\n            // this.view.src=this.imageSequenceResource.data[0].src;\n        }\n        //stock properties\n        this.view = $(this._bitmap_view);\n        //this.view=$(view);\n        //set object\n        this.view.css(\"position\", \"absolute\");\n        this.width = this.imageSequenceResource.data[0].data.naturalWidth;\n        this.height = this.imageSequenceResource.data[0].data.naturalHeight;\n    }\n    set bitmapData(bitmapData) {\n        this.view.src = bitmapData;\n    }\n    play(params) {\n        this.ticker = createjs.Ticker.addEventListener(\"tick\", this._tick.bind(this));\n    }\n    stop() {\n        createjs.Ticker.removeEventListener(\"tick\", this.ticker);\n    }\n    _tick() {\n        this.bypass = (this.bypass + 1 < this._framerateRatio) ? this.bypass + 1 : 0;\n        if (this.bypass != 0) {\n            return;\n        }\n        ;\n        //this.view.src=this.imageSequenceResource.data[this._frame].data.src;\n        this._bitmap_view.src = this.imageSequenceResource.data[this._frame].data.src;\n        if (this._frame >= this.imageSequenceResource.data.length - 1) {\n            this._frame = 0;\n        }\n        this._frame++;\n    }\n}\n"]}