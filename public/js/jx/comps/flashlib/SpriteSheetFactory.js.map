{"version":3,"sources":["../../../../src/jx/comps/flashlib/SpriteSheetFactory.js"],"names":["spriteSheetNo","uniqID","SpriteSheetFactory","params","_params","spriteSheet","mcs","_builder","initialize","callback","scale","jx","config","app","quality","length","target","w","mc","buildComplete","event","console","log","Date","now","_rasterizeTimeStart","removeEventListener","bind","removeAllEventListeners","urlParams","showspritesheet","undefined","win","window","open","document","write","_images","viewSpriteSheetResult","i","body","appendChild","close","createjs","SpriteSheetBuilder","maxWidth","flashOptimizer","spriteSheetMaxWidth","maxHeight","resultx","rasteriseScale","builderRasteriseScale","mcClassName","lib","getMCClass","alreadyRasterised","j","className","jxLabelPrefix","push","nominalBounds","width","timeline","labels","duration","index","addFrame","getTransformedBounds","addAnimation","name","setLabels","addMovieClip","clip","mcin","gotoAndStop","label","tools","cjs","arrangeFlashClipsNames","getChildrenByName","newLabels","getLabels","position","addEventListener","evt","ok","buildAsync","path","getAbsolutePath","id","parent","initClip","sprite","framerate","scaleX","scaleY","setTransform","x","y","skewY","skewX","gotoAndPlay","visible","listeners","_enabled","Object","defineProperties","set","value","rollout","on","pressup","mousedown","onClick","call","Sprite","getMCByPath","getMCByName","source","sourceRect","setupFunction","setupData","labelFunction","_data","ERR_RUNNING","rects","frameBounds","rect","bounds","getBounds","l","baseFrameIndex","_frames","r","_setupMovieClipFrame","f","d","_labels","lbls","n","sort","a","b","start","end","frames"],"mappings":"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","file":"SpriteSheetFactory.js","sourcesContent":["import JXObject from \"jx/core/JXObject\";\nlet spriteSheetNo = 0;\nlet uniqID = 0;\nexport default class SpriteSheetFactory extends JXObject {\n    constructor(params) {\n        super(params);\n        this._params = params;\n        this.spriteSheet = null;\n        this.mcs = null;\n        this._builder;\n        this.initialize();\n    }\n    initialize() { }\n    rasterize(mcs, callback, scale = this.jx.config.app.quality) {\n        if (mcs.length == 0) {\n            callback({ target: this, mcs: this.mcs, spriteSheet: this.spriteSheet });\n            return;\n        }\n        ;\n        this.mcs = mcs;\n        var w;\n        //scale=1\n        scale = scale || this.jx.config.quality;\n        var mc;\n        function buildComplete(event) {\n            console.log(\"Rasterization end\", event, (Date.now() - this._rasterizeTimeStart) / 1000, \"secondes\");\n            this._builder.removeEventListener(\"complete\", buildComplete.bind(this));\n            //builder.removeEventListener(\"complete\", evt=>console.log(evt));\n            this._builder.removeAllEventListeners();\n            this.spriteSheet = event.target.spriteSheet;\n            spriteSheetNo++;\n            //console.log(this.spriteSheet._frames)\n            if (this.jx.config.urlParams.showspritesheet != undefined && this.jx.config.urlParams.showspritesheet) { // ne pas utiliser sur ipad, pour test sur desktop. Affiche le spritesheet généré dans une nouvelle fenetre.\n                var win = window.open(\"\", \"win\" + spriteSheetNo); // a window object\n                win.document.open(\"text/html\");\n                win.document.write(\"<body>\" + this.spriteSheet._images.length + \"<br></body>\");\n                var viewSpriteSheetResult = \"\";\n                for (var i = 0; i < this.spriteSheet._images.length; i++) {\n                    win.document.write(\"<br>SpriteSheet \" + i);\n                    win.document.body.appendChild(this.spriteSheet._images[i]);\n                }\n                ;\n                //win.document.write( this.spriteSheet._images.length + \" SpritesSheets : <br>\" + viewSpriteSheetResult);\n                win.document.close();\n            }\n            callback({ target: this, mcs: this.mcs, spriteSheet: this.spriteSheet });\n        }\n        //--- create the sprite sheet builder:\n        this._builder = new createjs.SpriteSheetBuilder();\n        this._builder.scale = scale;\n        this._builder.maxWidth = this.jx.config.flashOptimizer.spriteSheetMaxWidth;\n        this._builder.maxHeight = this.jx.config.flashOptimizer.spriteSheetMaxWidth;\n        var resultx = [];\n        //--- analyze and prepare each mc child for rasterization.\n        for (var i = 0; i < this.mcs.length; i++) {\n            mc = this.mcs[i];\n            mc.rasteriseScale = mc.rasteriseScale || 1;\n            mc.builderRasteriseScale = scale;\n            var mcClassName = this._params.lib.getMCClass(mc);\n            //console.log(mcClassName)\n            var alreadyRasterised = false;\n            for (var j = 0; j < resultx.length; j++) {\n                if (resultx[j].className == mcClassName) {\n                    //console.log(resultx[j]);\n                    alreadyRasterised = true;\n                    mc.jxLabelPrefix = resultx[j].mc.jxLabelPrefix;\n                }\n            }\n            if (alreadyRasterised) {\n                //console.log(mc, \"alreadyRasterized\");\n            }\n            else {\n                resultx.push({ className: mcClassName, mc: mc });\n                w = mc.nominalBounds.width * scale;\n                //--- CASE A: mc owns only one frame.\n                if ((mc.timeline == undefined && mc.labels == undefined) || (mc.timeline.duration == 1)) {\n                    // not used\n                    // add the mcin as a frame, specify the bounds to draw, and grab the frame index:\n                    var index = this._builder.addFrame(mc, mc.getTransformedBounds(), mc.rasteriseScale);\n                    // add a named animation using the frame index:\n                    this._builder.addAnimation(mc.name + \"_E1\", index);\n                }\n                //--- CASE B: mc contains a simple animation along its timeline.\n                else if (mc.labels != undefined && mc.labels.length == 0) {\n                    var labels = {};\n                    mc.jxLabelPrefix = (++uniqID) + \"_\";\n                    labels[mc.jxLabelPrefix + \"E1\"] = 0;\n                    mc.timeline.setLabels(labels);\n                    this.addMovieClip(mc, null, mc.rasteriseScale);\n                }\n                //--- CASE C: mc contains timeline with labels\n                else {\n                    //--- cas C1: each labeled frame contains a single clip named 'clip', which contains a simple animation or single frame.\n                    if (mc.clip != null) { // use mc.clip , not mc.getChilByname('clip') because mc.name not exits in flash export.\n                        var mcin;\n                        for (var j = 0; j < mc.labels.length; j++) {\n                            mc.gotoAndStop(mc.labels[j].label);\n                            this.jx.tools.cjs.arrangeFlashClipsNames(mc); // warning: when 2 clips are each on a different label of mc, have same name, ex 'clip', flash set automatically mc properties 'clip' and 'clip_1'. Then, after arrangeFlashClipsNames, the clips are named 'clip' and 'clip_1' in place of 'clip' for both.\n                            mcin = this.jx.tools.cjs.getChildrenByName(mc, \"^clip\")[0];\n                            var newLabels = {};\n                            newLabels[mc.name + \"_\" + mc.labels[j].label] = 0;\n                            //--- if mcin num frames > 0, we use directly mcin.timeline\n                            if (mcin.timeline != undefined) {\n                                mcin.timeline.setLabels(newLabels);\n                                this.addMovieClip(mcin, mc.rasteriseScale || 1);\n                            }\n                            //--- if mcin num frame == 1, mcin.timeline not exists, we use directly the animation.\n                            else {\n                                // add the mcin as a frame, specify the bounds to draw, and grab the frame index:\n                                var index = this._builder.addFrame(mcin, mcin.getTransformedBounds(), mc.rasteriseScale || 1);\n                                // add a named animation using the frame index:\n                                this._builder.addAnimation(mc.name + \"_\" + mc.labels[j].label, index);\n                            }\n                        }\n                        ;\n                    }\n                    //--- cas C2: each animations is along the timeline, begin at labeled frame and finish to the next label\n                    else {\n                        var labels = mc.timeline.getLabels();\n                        var newLabels = {};\n                        for (var j = 0; j < labels.length; j++) {\n                            mc.jxLabelPrefix = (++uniqID) + \"_\";\n                            labels[j].label = mc.jxLabelPrefix + labels[j].label;\n                            newLabels[labels[j].label] = labels[j].position;\n                        }\n                        mc.timeline.setLabels(newLabels);\n                        this.addMovieClip(mc, null, mc.rasteriseScale || 1);\n                    }\n                }\n            }\n        }\n        this._rasterizeTimeStart = Date.now();\n        console.log(\"Rasterize start\");\n        //--- rasterize and build spritesheets\n        this._builder.addEventListener(\"complete\", buildComplete.bind(this));\n        //builder.addEventListener(\"complete\", evt=>console.log(evt));\n        this._builder.addEventListener(\"progress\", evt => console.log(evt));\n        var ok = false;\n        //try{\n        this._builder.buildAsync();\n        ok = true;\n        // }\n        // catch(err) {\n        //     var mess = \n        //     `${err}\n        //     The reasons could be:\n        //     - if it works in no-optimised mode, check there are no big animations in the fla, if so, remove it or force it to image by adding '_img_' at the end of occurence name.\n        //     `;\n        //     console.error(mess);\n        //     alert(mess);\n        //     //builder.stop();\n        //     ok=false;\n        // }\n    }\n    ;\n    getMCByName(name) {\n        //console.log(\"gmcbyname\", name, this.mcs)\n        for (var i = 0; i < this.mcs.length; i++) {\n            if (this.mcs[i].name == name) {\n                return this.mcs[i];\n            }\n        }\n        ;\n        return null;\n    }\n    getMCByPath(path) {\n        //console.log(\"gmcbyname\", name, this.mcs)\n        for (var i = 0; i < this.mcs.length; i++) {\n            if (this.jx.tools.cjs.getAbsolutePath(this.mcs[i]) == path) {\n                return this.mcs[i];\n            }\n        }\n        ;\n        return null;\n    }\n    getRasterizedClip({ id, parent, path }) {\n        return this.initClip({ id, parent, path });\n    }\n    initClip(params) {\n        var sprite = function (params) {\n            if (params.mc == null) {\n                //console.log(\"Error MovieClip not found \", params.id);\n                return null;\n            }\n            this.mc = params.mc;\n            this.sprite = params.sprite;\n            if (params.parent == null) {\n                console.log(this.mc);\n            }\n            var parent = params.parent; // || stage;\n            this.name = this.mc.name;\n            if (params.framerate != undefined) {\n                this.sprite.framerate = params.framerate;\n            }\n            ;\n            //var scale = 1/this.mc.rasteriseScale;\n            var scale = 1 / this.mc.builderRasteriseScale;\n            console.log(this.mc, this.mc.scaleX, this.mc.scaleY);\n            this.sprite.setTransform(this.mc.x, this.mc.y, (this.mc.skewY == 180 ? -scale : scale), (this.mc.skewX == 180 ? -scale : scale)); //skewX & skewY inversed here, that's normal, in flash export, a clip turned vertically set skewX to 180, if turned horizontally set skewY to 180\n            this.sprite.gotoAndPlay(this.mc.jxLabelPrefix + \"E1\");\n            this.sprite.name = this.mc.name;\n            this.sprite.visible = true;\n            this.listeners = {};\n            this._enabled = false;\n            Object.defineProperties(this, { \"enabled\": {\n                    set: function (value) {\n                        //console.log(\"enb\", this._enabled,value)\n                        if (value == this._enabled) {\n                            return;\n                        }\n                        ;\n                        this._enabled = value;\n                        if (value) {\n                            this.listeners.rollout = this.sprite.on(\"rollout\", evt => { });\n                            this.listeners.pressup = this.sprite.on(\"pressup\", evt => { });\n                            this.listeners.mousedown = this.sprite.on(\"mousedown\", evt => {\n                                if (params.onClick != undefined) {\n                                    params.onClick.call(this, { target: this });\n                                }\n                                ;\n                            });\n                        }\n                        else {\n                            this.sprite.removeAllEventListeners();\n                        }\n                    }\n                } });\n            Object.defineProperties(this, { \"visible\": {\n                    set: function (value) {\n                        this.sprite.visible = value;\n                    }\n                } });\n            this.gotoAndStop = function (label) {\n                this.sprite.gotoAndStop(typeof label == \"string\" ? this.mc.jxLabelPrefix + label : label);\n            };\n            this.gotoAndPlay = function (label) {\n                this.sprite.gotoAndPlay(typeof label == \"string\" ? this.mc.jxLabelPrefix + label : label);\n            };\n        };\n        params.sprite = new createjs.Sprite(this.spriteSheet);\n        if (params.path) {\n            params.mc = this.getMCByPath(params.path);\n        }\n        else {\n            params.mc = (params.id != undefined) ? this.getMCByName(params.id) : params.mc;\n        }\n        //var scale = params.mc.rasteriseScale || this.scale;\n        return new sprite(params);\n    }\n    /**\n     * This method is an adaptation of the createjs SpriteSheetBuilder.addMovieClip method.\n     * This will take a {{#crossLink \"MovieClip\"}}{{/crossLink}} instance, and add its frames and labels to this\n     * builder. Labels will be added as an animation running from the label index to the next label. For example, if\n     * there is a label named \"foo\" at frame 0 and a label named \"bar\" at frame 10, in a MovieClip with 15 frames, it\n     * will add an animation named \"foo\" that runs from frame index 0 to 9, and an animation named \"bar\" that runs from\n     * frame index 10 to 14.\n     *\n     * Note that this will iterate through the full MovieClip with {{#crossLink \"MovieClip/actionsEnabled:property\"}}{{/crossLink}}\n     * set to `false`, ending on the last frame.\n     * @method addMovieClip\n     * @param {MovieClip} source The source MovieClip instance to add to the SpriteSheet.\n     * @param {Rectangle} [sourceRect] A {{#crossLink \"Rectangle\"}}{{/crossLink}} defining the portion of the source to\n     * draw to the frame. If not specified, it will look for a {{#crossLink \"DisplayObject/getBounds\"}}{{/crossLink}}\n     * method, `frameBounds` Array, `bounds` property, or `nominalBounds` property on the source to use. If one is not\n     * found, the MovieClip will be skipped.\n     * @param {Number} [scale=1] The scale to draw the movie clip at.\n     * @param {Function} [setupFunction] A function to call immediately before drawing each frame. It will be called\n     * with three parameters: the source, setupData, and the frame index.\n     * @param {Object} [setupData] Arbitrary setup data to pass to setupFunction as the second parameter.\n     * @param {Function} [labelFunction] This method will be called for each MovieClip label that is added with four\n     * parameters: the label name, the source MovieClip instance, the starting frame index (in the movieclip timeline)\n     * and the end index. It must return a new name for the label/animation, or `false` to exclude the label.\n     **/\n    addMovieClip(source, sourceRect, scale, setupFunction, setupData, labelFunction) {\n        if (this._builder._data) {\n            throw createjs.SpriteSheetBuilder.ERR_RUNNING;\n        }\n        var rects = source.frameBounds;\n        var rect = sourceRect || source.bounds || source.nominalBounds;\n        if (!rect && source.getBounds) {\n            rect = source.getBounds();\n        }\n        if (!rect && !rects) {\n            return;\n        }\n        var i, l, baseFrameIndex = this._builder._frames.length;\n        var duration = source.timeline.duration;\n        //console.log(source);\n        for (i = 0; i < duration; i++) {\n            var r = (rects && rects[i]) ? rects[i] : rect;\n            //console.log(source)\n            this._builder.addFrame(source, r, scale, this._builder._setupMovieClipFrame, { i: i, f: setupFunction, d: setupData });\n        }\n        var labels = source.timeline._labels;\n        var lbls = [];\n        for (var n in labels) {\n            lbls.push({ index: labels[n], label: n });\n        }\n        if (lbls.length) {\n            lbls.sort(function (a, b) { return a.index - b.index; });\n            for (i = 0, l = lbls.length; i < l; i++) {\n                var label = lbls[i].label;\n                var start = baseFrameIndex + lbls[i].index;\n                var end = baseFrameIndex + ((i == l - 1) ? duration : lbls[i + 1].index);\n                var frames = [];\n                for (var j = start; j < end; j++) {\n                    frames.push(j);\n                }\n                if (labelFunction) {\n                    label = labelFunction(label, source, start, end);\n                    if (!label) {\n                        continue;\n                    }\n                }\n                this._builder.addAnimation(label, frames, true); // for now, this loops all animations.\n            }\n        }\n    }\n}\n"]}