{"version":3,"sources":["../../../src/jx/comps/StageView.js"],"names":["StageView","dataObject","Object","assign","renderMode","framerate","ratio","width","height","autoUpdate","fixedStageScale","autoResize","forceIOSStageResize","addEventDispatcher","render","view","canvas","_stage","_renderMode","_scale","jx","config","app","_autoResize","_ratio","_width","_height","Math","min","max","system","screen","resolution","pixelRatio","_allowZIndex","_enabled","children","createjs","Sprite","prototype","initialize","canvasHolder","$","id","css","prop","allowZIndex","get","style","msTransformOrigin","webkitTransformOrigin","MozTransformOrigin","transformOrigin","append","Stage","StageGL","console","error","scaleX","scaleY","update","enableMouseOver","Touch","isSupported","enable","Ticker","setFPS","_updateStage","evt","window","orientation","onOrientationChange","setTimeout","e","onResize","on","_onResizeListener","_addListeners","_listenersRef","mousedown","onmousedown","dispatch","target","details","off","_appFreezed","_stateBeforeFreeze","_autoUpdate","removeEventListener","addEventListener","_killed","removeAllChildren","remove","onorientationchange","x","y","child","result","argumentsLength","arguments","length","i","isJXComponent","cc","undefined","warn","maxZ","j","addChild","domView","parent","push","pop","indexOf","removeChild","splice","localToGlobal","globalToLocal","localToLocal","outputWidth","cache","coords","size","snapshot","getCacheDataURL","uncache","w","h","iw","ih","pRatio","devicePixelRatio","xRatio","yRatio","sRatio","pos","Number","replace","_scaleCorrection","scaleStr","msTransform","webkitTransform","MozTransform","transform","updateViewport","value","mouseX","mouseY"],"mappings":"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","file":"StageView.js","sourcesContent":["import Component from \"jx/core/comps/Component\";\n/**\n * StageView is a main container that manages multiples types of render.\n * (actually createjs(canvas) and DOM).\n * It works like a Flash stage, resizing all children proportionally, either\n * dom and createjs. Its use is adapted for\n * staged games.\n * When addChild is called, it detect render property of child component to\n * determine which render use. By default, all Dom elements are above the\n * canvas. These can be only above or behind the canvas.\n * The main purpose of the component is to use first canvas if possible, and\n * only use Dom when needed (rich texts, video), then its main goal is to be\n * able to replace the createjs component exactly at same pproperties, size,\n * placement,...\n *\n * It is essentially stabilized for the needed components (Text, Video), but\n * first implementation exists for Image, ImageSequence, Container.\n *\n * Ratio can be changed but not width and height.\n *\n * If mainCtrl class of an application extends presets/StageGameModule, a stage is already created, and all components can access it by this.jx.app.stage.\n *\n * @example\n *  this.stage = this.cc({type: \"StageView\"});\n *  this.stage.addChild(myComp);\n */\nexport default class StageView extends Component {\n    /**\n    * @param {object} dataObject\n    * @param {number} [dataObject.renderMode] - render mode, 'canvas' or 'webgl' (default=canvas).\n    * @param {number} [dataObject.framerate] - default = this.jx.config.app.framerate\n    * @param {number} [dataObject.ratio=10] -\n    */\n    constructor(dataObject) {\n        super(Object.assign({\n            renderMode: \"canvas\",\n            framerate: null,\n            ratio: null,\n            width: null,\n            height: null,\n            autoUpdate: true,\n            fixedStageScale: false,\n            autoResize: true,\n            forceIOSStageResize: true\n        }, dataObject));\n    }\n    _create() {\n        super._create();\n        this.addEventDispatcher(\"onmousedown\");\n        this.render = \"CJS\";\n        this.view = null;\n        this.canvas = null;\n        this._stage = null;\n        this._renderMode = this.dataObject.renderMode;\n        this._scale = 1;\n        this.framerate = this.dataObject.framerate || this.jx.config.app.framerate;\n        this.fixedStageScale = this.dataObject.fixedStageScale;\n        this._autoResize = this.dataObject.autoResize;\n        //--- the canvas width depends of screen resolution width. max 1280\n        if (this.dataObject.ratio) {\n            this._ratio = this.dataObject.ratio;\n            if (this.dataObject.width) {\n                this._width = this.dataObject.width;\n                this._height = this._width / this._ratio;\n            }\n            else if (this.dataObject.height) {\n                this._height = this.dataObject._height;\n                this._width = this._height * this._ratio;\n            }\n            else {\n                this._width = this.jx.config.app.width;\n                this._height = this._width / this._ratio;\n            }\n        }\n        else if (this.dataObject.width && this.dataObject.height) {\n            this._width = this.dataObject.width;\n            this._height = this.dataObject.height;\n            this._ratio = this._width / this._height;\n        }\n        else if (this.dataObject.width) {\n            this._ratio = this.jx.config.app.ratio;\n            this._width = this.dataObject.width;\n            this._height = this._width / this._ratio;\n        }\n        else if (this.dataObject.height) {\n            this._ratio = this.jx.config.app.ratio;\n            this._height = this.dataObject._height;\n            this._width = this._height * this._ratio;\n        }\n        else {\n            this._width = this.jx.config.app.width;\n            this._ratio = this.jx.config.app.ratio;\n            this._height = this._width / this._ratio;\n        }\n        this._width = Math.min(this._width, 1280, Math.max(this.jx.config.system.screen.resolution.width * this.jx.config.system.screen.pixelRatio, this.jx.config.system.screen.resolution.height * this.jx.config.system.screen.pixelRatio));\n        this._height = this._width / this._ratio;\n        this.addEventDispatcher(\"onclick\");\n        this._allowZIndex = true;\n        this._enabled = true;\n        this.children = [];\n        createjs.Sprite.prototype.initialize = createjs.Sprite; // hack needed for spritesheet to work\n        // Create canvas DOM elements\n        this.canvasHolder = $(`<div id=${this.id} class=\"canvasHolder\" ></div>`);\n        this.canvasHolder.css(\"position\", \"absolute\");\n        this.canvasHolder.css(\"width\", this._width + \"px\");\n        this.canvasHolder.css(\"height\", this._height + \"px\");\n        this.canvasHolder.css(\"top\", \"0px\");\n        this.canvasHolder.css(\"left\", \"0px\");\n        this.canvasHolder.css(\"bottom\", \"0px\");\n        this.canvasHolder.css(\"right\", \"0px\");\n        this.canvasHolder.css(\"margin\", \"0px\");\n        this.canvasHolder.css(\"padding\", \"0px\");\n        this.canvasHolder.css(\" box-sizing\", \"border-box\");\n        //this.canvasHolder.addClass(\"child\")\n        //this.canvasHolder.css(\"pointer-events\", \"none\");\n        var canvas = $(\"<canvas/>\");\n        canvas.prop(\"id\", \"canvas\");\n        canvas.prop(\"width\", this._width); // ? replace this with css doesn't work\n        canvas.prop(\"height\", this._height);\n        canvas.css(\"position\", \"absolute\");\n        //canvas.css(\"margin\", \"auto\");\n        canvas.css(\"box-sizing\", \"border-box\");\n        //canvas.css(\"border\", \"solid 1px #000000\");\n        canvas.css(\"background-color\", \"transparent\");\n        this.allowZIndex = this._allowZIndex;\n        canvas.css(\"-webkit-tap-highlight-color\", \"rgba(255,0,0,0)\");\n        this.view = this.canvasHolder[0];\n        this.canvas = canvas.get(0);\n        this.canvasHolder[0].style.msTransformOrigin = \"0px 0px\";\n        this.canvasHolder[0].style.webkitTransformOrigin = \"0px 0px\";\n        this.canvasHolder[0].style.MozTransformOrigin = \"0px 0px\";\n        this.canvasHolder[0].style.transformOrigin = \"0px 0px\";\n        this.canvas.style.msTransformOrigin = \"0px 0px\";\n        this.canvas.style.webkitTransformOrigin = \"0px 0px\";\n        this.canvas.style.MozTransformOrigin = \"0px 0px\";\n        this.canvas.style.transformOrigin = \"0px 0px\";\n        this.canvasHolder.append(canvas);\n        $(\"body\").append(this.canvasHolder);\n        // create createjs Stage and resize it to canvas\n        //var ctx = this.canvas.getContext( '2d' ); //? utile ?\n        if (this._renderMode == \"canvas\") {\n            this._stage = new createjs.Stage(this.canvas);\n        }\n        else if (this._renderMode == \"webgl\") {\n            if (createjs.StageGL) {\n                this._stage = new createjs.StageGL(this.canvas);\n            }\n            else {\n                console.error(\"WebGL lib not available. Easeljs and Tweenjs libraries are too olds, you need to update them to NEXT versions\");\n            }\n        }\n        else {\n            console.error(\"render mode  unknown\");\n        }\n        this._stage.scaleX = 1;\n        this._stage.scaleY = 1;\n        this._stage.update();\n        //--- enable rollover, out events\n        if (true) {\n            this._stage.enableMouseOver();\n        }\n        else {\n            this._stage.enableMouseOver(0);\n        }\n        if (createjs.Touch.isSupported()) {\n            createjs.Touch.enable(this._stage); // hack to eliminate 300ms delay on click on ipad\n        }\n        //--- Ticker createjs\n        //createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;\n        //createjs.Ticker.timingMode = createjs.Ticker.RAF;\n        createjs.Ticker.setFPS(this.framerate);\n        this._updateStage = evt => this._stage.update(evt);\n        this.autoUpdate = this.dataObject.autoUpdate;\n        if (typeof window.orientation !== 'undefined') {\n            var onOrientationChange = () => {\n                setTimeout((e) => this.onResize(e), 100);\n            };\n            $(window).on(\"orientationchange\", onOrientationChange);\n            this.onResize();\n        }\n        else {\n            this._onResizeListener = evt => this.onResize();\n            $(window).on(\"resize\", this._onResizeListener);\n            this.onResize();\n        }\n        // this.canvas.addEventListener(\"click\", evt=>{\n        //     this.onclick.dispatch({target:this});\n        // })\n        $(\"body\").append(this.canvasHolder);\n        this._addListeners();\n        /* strange hack resolving display bug offset on ios for some app but creating the bug for others apps.\n        then it's case by case. Set forceIOSStageResize dataObject property to false in MainCtrl if problem appears\n        */\n        if (this.dataObject.forceIOSStageResize) {\n            // this.onResize();\n        }\n    }\n    _addListeners() {\n        this._listenersRef = this._listenersRef || {};\n        this._listenersRef.mousedown = this._stage.on(\"mousedown\", evt => {\n            if (this._enabled) {\n                this.onmousedown.dispatch({ target: this, details: evt });\n            }\n        });\n    }\n    _removeListeners() {\n        if (!this._stage)\n            return;\n        this._listenersRef = this._listenersRef || {};\n        this.view.off(\"mousedown\", this._listenersRef.onmousedown);\n    }\n    appFreeze() {\n        //console.log(\"freeze\", this);\n        if (this._appFreezed)\n            return false;\n        this._stateBeforeFreeze = { autoUpdate: this._autoUpdate };\n        this.autoUpdate = false;\n        super.appFreeze();\n    }\n    appUnfreeze() {\n        //console.log(\"unfreeze\", this);\n        if (!this._appFreezed)\n            return false;\n        this.autoUpdate = this._stateBeforeFreeze.autoUpdate;\n        super.appUnfreeze();\n    }\n    pause() {\n        if (super.pause()) {\n            createjs.Ticker.removeEventListener(\"tick\", this._stage);\n        }\n    }\n    resume() {\n        if (super.resume()) {\n            createjs.Ticker.addEventListener(\"tick\", this._stage);\n        }\n    }\n    close() {\n        if (super.close()) {\n        }\n    }\n    set allowZIndex(value) {\n        this._allowZIndex = value;\n        $(this.canvas).css(\"z-index\", value ? 1 : \"auto\");\n    }\n    kill() {\n        if (this._killed)\n            return;\n        this.removeAllChildren();\n        this.autoUpdate = false;\n        this.canvasHolder.remove();\n        this._stage = null;\n        window.onorientationchange = null;\n        if (this._onResizeListener) {\n            $(window).off(\"resize\", this._onResizeListener);\n            this._onResizeListener = null;\n        }\n        super.kill();\n    }\n    /** Force stage update. WARNING, use this in a loop can alters clips framerates. */\n    update(evt = null) {\n        this._stage.update(evt);\n    }\n    set autoUpdate(value) {\n        if (this._autoUpdate == value)\n            return;\n        this._autoUpdate = value;\n        if (this._autoUpdate) {\n            createjs.Ticker.addEventListener(\"tick\", this._updateStage);\n        }\n        else {\n            createjs.Ticker.removeEventListener(\"tick\", this._updateStage);\n        }\n    }\n    set ratio(value) {\n        this._ratio = value;\n        this._height = this._width / this._ratio;\n        // this.canvasHolder.css(\"height\", this._height+\"px\");\n        // $(this.canvas).prop(\"height\",this._height);\n        this.onResize();\n    }\n    get ratio() {\n        return this._ratio;\n    }\n    get enabled() {\n        return this._enabled;\n    }\n    set enabled(value) {\n        this._enabled = value;\n    }\n    getBounds() {\n        return { x: this.x, y: this.y, width: this.width, height: this.height };\n    }\n    /** */\n    get x() {\n        return 0;\n    }\n    /**  */\n    get y() {\n        return 0;\n    }\n    /** */\n    get width() {\n        return this._width;\n    }\n    /**  */\n    get height() {\n        return this._height;\n    }\n    /**  */\n    set visible(value) {\n        this.canvasHolder.css(\"display\", value ? \"initial\" : \"none\");\n    }\n    /**  */\n    get visible() {\n        return this.canvasHolder.css(\"display\") != \"none\";\n    }\n    /**\n     * @param {Object|Component} child - can be an existing component or a dataObject\n     * for new component creation.\n     */\n    addChild(...child) {\n        let result = [];\n        let argumentsLength = arguments.length;\n        for (let i = 0; i < argumentsLength; i++) {\n            let child = arguments[i];\n            child = (child.isJXComponent) ? child : this.cc(child);\n            if (child.view == undefined) {\n                console.warn(\"Could not Add child as it does not have a view\", child);\n                break;\n            }\n            if (child.render == \"DOM\") {\n                if (this._allowZIndex) {\n                    let children = this.canvasHolder.children();\n                    let maxZ = 0;\n                    for (let j = 0; j < children.length; j++) {\n                        maxZ = Math.max(maxZ, $(children[j]).css(\"z-index\"));\n                    }\n                    ;\n                    this.canvasHolder.append(child.view);\n                    child.view.css(\"z-index\", maxZ + 1);\n                }\n                else {\n                    this.canvasHolder.append(child.view);\n                }\n            }\n            else {\n                this._stage.addChild(child.view);\n                if (child.domView) {\n                    this.addChild(child.domView);\n                }\n                ;\n            }\n            child.parent = this;\n            this.children.push(child);\n            result.push(child);\n            child.parent = this;\n        }\n        ;\n        //this.onResize();\n        return result.pop();\n    }\n    /**  */\n    hasChild(child) {\n        //console.log(this.children, this.children.indexOf(child))\n        return this.children.indexOf(child) != -1;\n    }\n    /**  */\n    removeChild(child) {\n        if (!this._killed) {\n            if (child.render == \"DOM\") {\n                child.view.remove();\n            }\n            else {\n                this._stage.removeChild(child.view);\n            }\n            this.children.splice(this.children.indexOf(child), 1);\n        }\n        ;\n        child.parent = null;\n    }\n    removeAllChildren() {\n        var child;\n        for (var i = 0; i < this.children.length; i++) {\n            child = this.children[i];\n            if (child.render == \"DOM\") {\n                child.view.remove();\n                child.parent = null;\n            }\n            else {\n                this._stage.removeChild(child.view);\n                child.parent = null;\n            }\n        }\n        ;\n        this.children.length = 0;\n    }\n    localToGlobal(...args) {\n        return this._stage.localToGlobal(...args);\n    }\n    globalToLocal(...args) {\n        return this._stage.globalToLocal(...args);\n    }\n    localToLocal(...args) {\n        return this._stage.localToLocal(...args);\n    }\n    get mouseCanvasX() {\n        return this._stage.mouseX;\n    }\n    get mouseCanvasY() {\n        return this._stage.mouseY;\n    }\n    get mouseX() {\n        return this._stage.mouseX * this._scaleCorrection;\n    }\n    get mouseY() {\n        return this._stage.mouseY * this._scaleCorrection;\n    }\n    get scale() {\n        return this._scale;\n    }\n    /**\n     * Take a snapshot of this stage (only cjs elements).\n     * @param  {Number} options.x   crop x\n     * @param  {Number} options.y   crop y\n     * @param  {Number} options.width   crop width\n     * @param  {Number} options.height   crop height\n     * @param  {Number} options.outputWidth resize result to match with outputWidth\n     * @return {string}                     result in data string png64 format\n     */\n    takeSnapshot({ x = null, y = null, width = null, height = null, outputWidth = null }) {\n        if (x === null) {\n            this._stage.cache(0, 0, this.width, this.height, outputWidth ? outputWidth / this.width : 1);\n        }\n        else {\n            let coords = this._stage.globalToLocal(x, y);\n            let size = this._stage.globalToLocal(width, height);\n            this._stage.cache(coords.x, coords.y, size.x, size.y, outputWidth ? outputWidth / size.x : 1);\n        }\n        let snapshot = this._stage.getCacheDataURL();\n        this._stage.uncache();\n        return snapshot;\n    }\n    onResize(evt = null) {\n        if (!this._autoResize)\n            return;\n        $(\"body\").css(\"display\", \"none\");\n        var w = this._width, h = this._height;\n        var iw = $(window).width(), ih = $(window).height();\n        var pRatio = window.devicePixelRatio || 1;\n        var xRatio = iw / w, yRatio = ih / h, sRatio = 1;\n        sRatio = Math.min(xRatio, yRatio);\n        var pos = { x: iw / 2 - w * sRatio / 2, y: ih / 2 - h * sRatio / 2 };\n        $(\"body\").css(\"display\", \"block\");\n        this.canvasHolder.css(\"left\", Number(pos.x) + \"px\");\n        this.canvasHolder.css(\"top\", Number(pos.y) + \"px\");\n        if (!this.fixedStageScale) {\n            this._stage.scaleX = pRatio * sRatio;\n            this._stage.scaleY = pRatio * sRatio;\n            $(this.canvas).prop(\"width\", w * pRatio * sRatio);\n            $(this.canvas).prop(\"height\", h * pRatio * sRatio);\n        }\n        ;\n        this.canvas.style.width = w * sRatio + 'px';\n        this.canvas.style.height = h * sRatio + 'px';\n        var width = Number(this.canvasHolder.css(\"width\").replace(\"px\", \"\"));\n        var ratio = (iw - pos.x * 2) / width;\n        this._scale = ratio;\n        this._scaleCorrection = 1 / (ratio * pRatio);\n        let scaleStr = \"scale(\" + ratio + \")\";\n        this.canvasHolder[0].style.msTransform = scaleStr;\n        this.canvasHolder[0].style.webkitTransform = scaleStr;\n        this.canvasHolder[0].style.MozTransform = scaleStr;\n        this.canvasHolder[0].style.transform = scaleStr;\n        scaleStr = \"scale(\" + 1 / ratio + \")\";\n        this.canvas.style.msTransform = scaleStr;\n        this.canvas.style.webkitTransform = scaleStr;\n        this.canvas.style.MozTransform = scaleStr;\n        this.canvas.style.transform = scaleStr;\n        this.update();\n        if (this._renderMode == \"webgl\") {\n            this._stage.updateViewport(this.canvas.width, this.canvas.height);\n        }\n    }\n}\n"]}